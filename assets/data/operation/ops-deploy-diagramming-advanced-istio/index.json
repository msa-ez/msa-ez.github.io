{"hash":"1a586d8710c81d28d4f8f8ef1afb059074f33880","data":{"markdownPage":{"id":"6ea72afc16218ffb67ad57f3c0b5c48f","title":"Istio Mesh","description":"","path":"/operation/ops-deploy-diagramming-advanced-istio/","timeToRead":3,"content":"<h1 id=\"istio-mesh\"><a href=\"#istio-mesh\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Istio Mesh</h1>\n<p>Based on the provided 12th event storming model, utilize the deployment modeling tool provided by MSAEZ to automatically generate the manifest YAML for Kubernetes objects. Apply these manifests to the cluster.</p>\n<h2 id=\"event-storming-model-preparation\"><a href=\"#event-storming-model-preparation\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Event Storming Model Preparation</h2>\n<ul>\n<li>Load the model from the link in a new tab.\n<strong><a href=\"https://www.msaez.io/#/storming/mallbasic-for-ops\" target=\"_blank\" rel=\"noopener noreferrer\">Model Link</a></strong></li>\n<li>If the model doesn't load in the browser, click on the avatar icon (person-shaped) in the upper right, log in with your <strong>Github</strong> account, and reload.</li>\n<li>The 12th event storming model consisting of orders, delivery, and products should appear. </li>\n<li>The loaded model will not display the sticker list in the right palette. Click on the FORK icon in the top menu to clone the given model.</li>\n</ul>\n<p><img src=\"https://github.com/acmexii/demo/assets/35618409/1e16e849-7ae9-4b33-b39c-db4ef0939507\" alt=\"image\"></p>\n<ul>\n<li>The sticker list should now appear in the right palette.</li>\n</ul>\n<h2 id=\"deployment-modeling\"><a href=\"#deployment-modeling\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Deployment Modeling</h2>\n<ul>\n<li>Add Istio topping to the forked model.</li>\n<li>Adding Istio topping is as simple as going to <strong>Code</strong> > <strong>Preview</strong> > <strong>Toppings</strong> in the menu and checking Istio under Service Mesh.</li>\n</ul>\n<p><img src=\"https://github.com/acmexii/demo/assets/35618409/4dfd204a-39c0-4f34-a2e6-d14802cd5d7b\" alt=\"image\"></p>\n<ul>\n<li>After adding Istio topping, if you check the Kubernetes folder in the code list, you'll see <strong>template</strong> > <strong>istio.yml</strong> added.</li>\n</ul>\n<p><img src=\"https://github.com/acmexii/demo/assets/35618409/5ed07284-52d9-4058-82e4-40c343d41b3f\" alt=\"image\"></p>\n<ul>\n<li>The Istio CRDs objects added by MSAEZ are as follows:</li>\n</ul>\n<blockquote>\n<p>Gateway: Istio Ingressgateway-based Istio Gateway </p>\n<p>VirtualService: An object determining how requests route to which service (or Subset) and the amount of traffic it should receive</p>\n<p>DestinationRule: Defines Subsets (stable, canary) for each service container and sets routing policies (load balancing, connection pool, etc.)</p>\n</blockquote>\n<h2 id=\"detailed-design-of-istio-objects\"><a href=\"#detailed-design-of-istio-objects\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Detailed Design of Istio Objects</h2>\n<ul>\n<li>Click on <strong>DEPLOY</strong> in the top menu to see the Istio object model.</li>\n</ul>\n<p><img src=\"https://github.com/acmexii/demo/assets/35618409/07d45fce-528a-4261-a1e3-c100e068c6b0\" alt=\"image\"></p>\n<p><img src=\"https://github.com/acmexii/demo/assets/35618409/e4ee1273-bf3a-43bb-8b8b-604307c677be\" alt=\"image\"></p>\n<blockquote>\n<p><strong>main-gw</strong> Gateway object using Istio Ingressgateway</p>\n<p><strong>drule-order</strong> DestinationRule object with two Subsets (stable, canary)</p>\n<p><strong>vsvc-order</strong> VirtualService object routing the <strong>order</strong> Service with weights based on Subsets</p>\n<p>Various conditions (uri, method, headers, port, source Labels, gateways, queryParams) for routing can be configured</p>\n<p>The default two Subsets (stable, canary) are identical, so modifying the weights will still route to the same service, but can be used for future Blue-Green and Canary deployments</p>\n</blockquote>\n<ul>\n<li>Similar Istio CRDs objects are automatically generated for the delivery and product services.</li>\n</ul>\n<p><img src=\"https://github.com/acmexii/demo/assets/35618409/32f67182-ef3e-4773-bfe1-fe7b49bc96b6\" alt=\"image\"></p>\n<h2 id=\"deploy-to-the-cluster\"><a href=\"#deploy-to-the-cluster\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Deploy to the Cluster</h2>\n<ul>\n<li>Manually deploy using the client (kubectl) on the configured cluster context.</li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\">kubectl apply -f kubernetes/template/template.yml\nkubectl apply -f kubernetes/template/istio.yml</code></pre>\n<ul>\n<li>If Istio is not installed on the target cluster, install Istio with the following commands.</li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\">export ISTIO_VERSION=1.18.6\ncurl -L https://istio.io/downloadIstio | ISTIO_VERSION=$ISTIO_VERSION TARGET_ARCH=x86_64 sh -</code></pre>\n<ul>\n<li>Move to the Istio package folder and set the execution path.</li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\">cd istio-$ISTIO_VERSION\nexport PATH=$PWD/bin:$PATH</code></pre>\n<ul>\n<li>Install Istio with the <strong>demo</strong> profile.</li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\">istioctl install --set profile=demo --set hub=gcr.io/istio-release</code></pre>\n<pre class=\"language-text\"><code class=\"language-text\">    ✔ Istio core installed\n    ✔ Istiod installed\n    ✔ Egress gateways installed\n    ✔ Ingress gateways installed\n    ✔ Installation complete</code></pre>\n<ul>\n<li>Set Istio to be applied to the <strong>default</strong> namespace.</li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\">kubectl label namespace default istio-injection=enabled</code></pre>\n<ul>\n<li>Apply the generated istio.yml and 12st Mall deployment yaml.</li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\">kubectl apply -f kubernetes/template/template.yml</code></pre>\n<ul>\n<li>Check the deployed services and Istio CRDs objects.</li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\">kubectl get pod</code></pre>\n<pre class=\"language-text\"><code class=\"language-text\">NAME                        READY   STATUS    RESTARTS   AGE\ndelivery-588b45cc85-r9bsn   2/2     Running   0          3m54s\nmy-kafka-0                  2/2     Running   0          5m58s\norder-55498f4b8f-x9rlr      2/2     Running   0          3m54s\nproduct-75f5b7c4fd-9wxnr    2/2     Running   0          3m54s</code></pre>\n<ul>\n<li>Check the CRDs objects for routing rules for each deployed service.</li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\">kubectl get VirtualService</code></pre>\n<pre class=\"language-text\"><code class=\"language-text\">NAME            GATEWAYS      HOSTS   AGE\nvsvc-delivery   [&quot;main-gw&quot;]   [&quot;*&quot;]   8m8s\nvsvc-order      [&quot;main-gw&quot;]   [&quot;*&quot;]   8m8s\nvsvc-product    [&quot;main-gw&quot;]   [&quot;*&quot;]   8m7s</code></pre>\n<ul>\n<li>Check the CRDs objects for routing policies for each service.</li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\">kubectl get DestinationRule</code></pre>\n<pre class=\"language-text\"><code class=\"language-text\">destrule-delivery   delivery   9m22s\ndestrule-order      order      9m22s\ndestrule-product    product    9m21s</code></pre>\n<ul>\n<li>Obtain the Istio Ingress Gateway address and access the order service URI (/orders).</li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\">curl GET [ISTIO INGRESS GATEWAY]/orders</code></pre>\n<pre class=\"language-text\"><code class=\"language-text\">HTTP/1.1 200 OK\ncontent-type: application/hal+json\ndate: Tue, 19 Dec 2023 01:55:41 GMT\nserver: istio-envoy\ntransfer-encoding: chunked\nvary: Origin,Access-Control-Request-Method,Access-Control-Request-Headers\nx-envoy-upstream-service-time: 10\n\n{\n    &quot;_links&quot;: {\n        &quot;orders&quot;: {\n            &quot;href&quot;: &quot;http://34.22.90.243/orders{?page,size,sort}&quot;,\n            &quot;templated&quot;: true\n        },\n        &quot;profile&quot;: {\n            &quot;href&quot;: &quot;http://34.22.90.243/profile&quot;\n        }\n    }\n}</code></pre>\n","sidebar":"started","next":"","prev":"","headings":[{"depth":1,"value":"Istio Mesh","anchor":"#istio-mesh"},{"depth":2,"value":"Event Storming Model Preparation","anchor":"#event-storming-model-preparation"},{"depth":2,"value":"Deployment Modeling","anchor":"#deployment-modeling"},{"depth":2,"value":"Detailed Design of Istio Objects","anchor":"#detailed-design-of-istio-objects"},{"depth":2,"value":"Deploy to the Cluster","anchor":"#deploy-to-the-cluster"}]},"allMarkdownPage":{"edges":[{"node":{"path":"/tool/si-gpt/","title":"Code Implementation with ChatGPT"}},{"node":{"path":"/tool/on-prem-inst/","title":"Installing on-premise MSA-Easy"}},{"node":{"path":"/tool/model-driven/","title":"Code Generation"}},{"node":{"path":"/tool/marketplace/","title":"Marketplace"}},{"node":{"path":"/tool/k8s-modeling/","title":"K8s Deployment Modeling"}},{"node":{"path":"/tool/infrastructure-modeling/","title":"Infrastructure Modeling (Kubernetes)"}},{"node":{"path":"/tool/google-drive-examples/","title":"Google Drive Examples"}},{"node":{"path":"/tool/event-storming-tool/","title":"EventStorming"}},{"node":{"path":"/tool/development-practice/","title":"Registration Course"}},{"node":{"path":"/tool/cloud-ide-tool/","title":"Cloud IDE"}},{"node":{"path":"/templates-language/springboot-java-template/","title":"Spring Boot/Java Template"}},{"node":{"path":"/tool/chat-gpt/","title":"Creating Models with ChatGPT"}},{"node":{"path":"/tool/attending-lectures/","title":"Attending lectures"}},{"node":{"path":"/templates-language/python-template/","title":"Python template "}},{"node":{"path":"/templates-language/go-template/","title":"Go Template "}},{"node":{"path":"/started/key-features/","title":"Key Features"}},{"node":{"path":"/started/","title":"Introduction"}},{"node":{"path":"/started/event-storming-learning/","title":"Event Storming Learning"}},{"node":{"path":"/started/domain-driven/","title":"Domain-Driven Design Learning"}},{"node":{"path":"/info/pricing/","title":"Pricing"}},{"node":{"path":"/operation/ops-deploy-diagramming-advanced-pvc/","title":"Persistent Volume"}},{"node":{"path":"/operation/ops-deploy-diagramming-basic-objects/","title":"12st Mall Basic Deploy"}},{"node":{"path":"/operation/ops-deploy-diagramming-advanced-istio/","title":"Istio Mesh"}},{"node":{"path":"/operation/ops-deploy-diagramming-advanced-ingress/","title":"Ingress Deployment Model Design"}},{"node":{"path":"/operation/ops-deploy-diagramming-advanced-hpa/","title":"Automatic Scaling (HPA) Deployment"}},{"node":{"path":"/info/partnership/","title":"Partner Program"}},{"node":{"path":"/example-scenario/online-lecture/","title":"Internet lecture system"}},{"node":{"path":"/info/company/","title":"Cases"}},{"node":{"path":"/example-scenario/food-delivery/","title":"food delivery"}},{"node":{"path":"/example-scenario/library-system/","title":"library system"}},{"node":{"path":"/example-scenario/animal-hospital/","title":"Veterinary Practice Management System"}},{"node":{"path":"/example-scenario/accommodation-reservation/","title":"AirBnB"}},{"node":{"path":"/development/pub-sub/","title":"Pub/Sub Integration"}},{"node":{"path":"/development/oauth2with-keycloak/","title":"JWT Token-based Authentication and Authorization"}},{"node":{"path":"/development/monolith-2-misvc/","title":"Request/Response Communication in MSA Integration"}},{"node":{"path":"/development/dp-cqrs/","title":"Data Projection with CQRS"}},{"node":{"path":"/development/gateway/","title":"API Gateway"}},{"node":{"path":"/development/cna-start/","title":"Running Unit Microservices"}},{"node":{"path":"/development/choreography-saga/","title":"Choreography Saga"}},{"node":{"path":"/custom-template/unit-test/","title":"Test Automation"}},{"node":{"path":"/custom-template/template-structure/","title":"Template File Structure"}},{"node":{"path":"/custom-template/tutorial/","title":"Concept of Custom Template"}},{"node":{"path":"/custom-template/template-editor/","title":"Template Editor"}},{"node":{"path":"/custom-template/template-editor-custom-template/","title":"Creating Custom Templates in MSAEZ"}},{"node":{"path":"/custom-template/mock-server/","title":"Open API 3.0-based Mock Server Generation Topping(New)"}},{"node":{"path":"/custom-template/loop-conditional-statement/","title":"Loop & Conditional Statement"}},{"node":{"path":"/custom-template/helper/","title":"Helper"}},{"node":{"path":"/custom-template/global-helper/","title":"Global Helper"}},{"node":{"path":"/custom-template/designing-template/","title":"Developing Custom Template"}},{"node":{"path":"/business/","title":"Eventstorming - Shopping Mall"}},{"node":{"path":"/custom-template/custom-template/","title":"Custom Template Objects"}},{"node":{"path":"/contact/question/","title":"CONTACT"}},{"node":{"path":"/business/eventstorming-fooddelivery/","title":"[이벤트스토밍] - DDD Food Delivery 예제"}},{"node":{"path":"/business/ddd-google-drive/","title":"[이벤트스토밍] - 구글 드라이브 예제"}}]}},"context":{}}