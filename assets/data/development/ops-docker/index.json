{"hash":"fa5fedf1848133ded319caa58f5dc027d2a72899","data":{"markdownPage":{"id":"5a7c9a2871abafa799a0b0592d2b9534","title":"Application Packaging with Container (Docker)","description":"","path":"/development/ops-docker/","timeToRead":4,"content":"<h1 id=\"application-packaging-with-container-docker\"><a href=\"#application-packaging-with-container-docker\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Application Packaging with Container (Docker)</h1>\n<h3 id=\"how-to-utilize-docker-image\"><a href=\"#how-to-utilize-docker-image\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>How to Utilize Docker Image</h3>\n<h4 id=\"create-an-image-based-conatiner\"><a href=\"#create-an-image-based-conatiner\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Create an image-based Conatiner</h4>\n<pre class=\"language-text\"><code class=\"language-text\">docker image ls\ndocker run --name my-nginx -d -p 8080:80 nginx\ndocker run --name my-new-nginx -d -p 8081:80 nginx\n\ndocker image ls\ndocker container ls   # = docker ps</code></pre>\n<ul>\n<li>\n<p>Check the Service</p>\n<ul>\n<li>Cloud IDE > Labs > Open Ports > 8080</li>\n<li>Cloud IDE > Labs > Open Ports > 8081</li>\n</ul>\n</li>\n<li>Check by httpie</li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\">http :8080\nhttp :8081</code></pre>\n<h4 id=\"delete-container--image\"><a href=\"#delete-container--image\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Delete Container &#x26; Image</h4>\n<ul>\n<li>Before deleting the image, we must get rid of the container using them.</li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\">docker container ls ; // check the running container\ndocker container stop my-nginx  #docker stop &lt;containerid&gt;\ndocker container stop my-new-nginx\ndocker container rm my-nginx\ndocker container rm my-new-nginx\ndocker image rm nginx\ndocker images</code></pre>\n<ul>\n<li>Delete all at once:</li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\">docker stop $(docker ps -a -q) &amp;&amp; docker rm $(docker ps -a -q)</code></pre>\n<h4 id=\"create-image\"><a href=\"#create-image\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Create Image</h4>\n<ul>\n<li>\n<p>Create a build script(Dockerfile) of application &#x26; image.</p>\n<ul>\n<li>Cloud IDE > File > Folder > put in 'Docker'</li>\n<li>Create two files below under the created folder.</li>\n<li>Cloud IDE > File > New File > put in 'index.html'</li>\n<li>Put in the line below at index.html </li>\n</ul>\n</li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\">   &lt;h1&gt; Hi~ My name is Hong Gil-Dong...~~~ &lt;/h1&gt;</code></pre>\n<ul>\n<li>Save it.</li>\n<li>Cloud IDE > File > New File > put in 'Dockerfile' (no extension)</li>\n<li>Put in the line below at Dockerfile</li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\">    FROM nginx\n    COPY index.html /usr/share/nginx/html/</code></pre>\n<ul>\n<li>Save it.</li>\n<li>Build the image</li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\">docker build -t apexacme/welcome:v1 .\ndocker images\ndocker run -p 8080:80 apexacme/welcome:v1</code></pre>\n<h4 id=\"push-image-to-remote-registryhubdockercom\"><a href=\"#push-image-to-remote-registryhubdockercom\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Push Image to Remote Registry(Hub.docker.com)</h4>\n<ul>\n<li>Create docker hub account</li>\n<li>\n<p>Access to <a href=\"https://hub.docker.com\" target=\"_blank\" rel=\"noopener noreferrer\">https://hub.docker.com</a></p>\n<ul>\n<li>Sign-Up &#x26; E-Mail verification</li>\n</ul>\n</li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\">docker login \ndocker push apexacme/welcome:v1\n# ex) If &#39;apexacme&#39; is your account:</code></pre>\n<blockquote>\n<p>Notice: If the error 'access denied' came out, you are not logged in or you didn't make your repository name with your account name. e.g. apexacme --> your own account</p>\n</blockquote>\n<h4 id=\"check-the-image-created-at-docker-hub\"><a href=\"#check-the-image-created-at-docker-hub\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Check the Image created at Docker Hub</h4>\n<ul>\n<li>Access to <a href=\"https://hub.docker.com\" target=\"_blank\" rel=\"noopener noreferrer\">https://hub.docker.com</a></li>\n<li>Reload repositories menu and check pushed images.</li>\n</ul>\n<h4 id=\"create-a-container-based-on-docker-hub-image\"><a href=\"#create-a-container-based-on-docker-hub-image\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Create a Container based on Docker Hub Image</h4>\n<pre class=\"language-text\"><code class=\"language-text\">docker image rm apexacme/welcome:v1\ndocker run --name=welcome -d -p 8080:80 apexacme/welcome:v1</code></pre>\n<ul>\n<li>Check if the service is running well:\nOpen new terminal and put in the command below. (Menu > Terminal > New Terminal)</li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\">$ http localhost:8080\n\nHTTP/1.1 200 OK\nAccept-Ranges: bytes\nConnection: keep-alive\nContent-Length: 23\nContent-Type: text/html\nDate: Wed, 12 May 2021 05:12:28 GMT\nETag: &quot;609b5cd7-17&quot;\nLast-Modified: Wed, 12 May 2021 04:43:03 GMT\nServer: nginx/1.19.10\n\n&lt;h1&gt; Hello world &lt;/h1&gt;</code></pre>\n<h3 id=\"packaging-java-application\"><a href=\"#packaging-java-application\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Packaging Java Application</h3>\n<ul>\n<li>Open a terminal, move to order/delivery/gateway folder and run the command below.</li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\">cd inventory\nmvn package -B -Dmaven.test.skip=true</code></pre>\n<ul>\n<li>Check if the jar file has been created at target folder.</li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\">java -jar target/inventory-0.0.1-SNAPSHOT.jar</code></pre>\n<p>Check if we can run it by the command.</p>\n<ul>\n<li>ctrl+c to get out of jar execution.</li>\n</ul>\n<ul>\n<li>Check if Dockerfile is placed on the top root of order, delivery and gateway.</li>\n<li>Run the command below at the file path of Dockerfile. </li>\n</ul>\n<pre class=\"language-text\"><code class=\"language-text\"> docker login\n docker build -t [dockerhub ID]/inventory:[Today&#39;s date] .     \n docker images\n docker push [dockerhub ID]/inventory:[Today&#39;s date]  </code></pre>\n<ul>\n<li>\n<p>Run it by docker run</p>\n<pre class=\"language-text\"><code class=\"language-text\">docker run  [dockerhub ID]/inventory:[Today&#39;s date]  </code></pre>\n</li>\n</ul>\n<h3 id=\"preview-of-next-lab\"><a href=\"#preview-of-next-lab\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Preview of Next Lab</h3>\n<p>Kubernetes Sandbox: <a href=\"https://kubernetes.io/docs/tutorials/kubernetes-basics/deploy-app/deploy-interactive/\" target=\"_blank\" rel=\"noopener noreferrer\">https://kubernetes.io/docs/tutorials/kubernetes-basics/deploy-app/deploy-interactive/</a></p>\n<pre class=\"language-text\"><code class=\"language-text\">$ kubectl run myhomepage --image=jinyoung/welcome:v1\n\ndeployment.apps/myhomepage created\n\n\n$ kubectl expose deploy myhomepage --port=80 --type=LoadBalancer\n\nservice/myhomepage exposed\n\n\n$ kubectl get svc -w\nNAME         TYPE           CLUSTER-IP      EXTERNAL-IP                                                                   PORT(S)        AGE\nmyhomepage   LoadBalancer   10.100.98.191   addef84b932ff416186e2166ff397d74-589148294.ap-northeast-2.elb.amazonaws.com   80:30271/TCP   9s\n\n\n$ http addef84b932ff416186e2166ff397d74-589148294.ap-northeast-2.elb.amazonaws.com:80\nHTTP/1.1 200 OK\nAccept-Ranges: bytes\nConnection: keep-alive\nContent-Length: 23\nContent-Type: text/html\nDate: Wed, 12 May 2021 05:36:40 GMT\nETag: &quot;609b5cd7-17&quot;\nLast-Modified: Wed, 12 May 2021 04:43:03 GMT\nServer: nginx/1.19.10\n\n&lt;h1&gt; Hello world &lt;/h1&gt;\n\n\nkubectl get all\nNAME                              READY   STATUS    RESTARTS   AGE\npod/myhomepage-58dd9ffb74-kw5km   1/1     Running   0          17m\n\nNAME                 TYPE           CLUSTER-IP      EXTERNAL-IP                                                                   PORT(S)        AGE\nservice/myhomepage   LoadBalancer   10.100.98.191   addef84b932ff416186e2166ff397d74-589148294.ap-northeast-2.elb.amazonaws.com   80:30271/TCP   15m\n\nNAME                         READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/myhomepage   1/1     1            1           17m\n\nNAME                                    DESIRED   CURRENT   READY   AGE\nreplicaset.apps/myhomepage-58dd9ffb74   1         1         1       17m\n\n\n$ kubectl get rs -w\nNAME                    DESIRED   CURRENT   READY   AGE\nmyhomepage-58dd9ffb74   1         1         1       27m\n\n\n\n#### New Terminal\n\n$ kubectl delete po --all\n\npod &quot;myhomepage-58dd9ffb74-wjf68&quot; deleted\n\n\n\nCheck if desired &amp; current of rs remains (pod regenerates) on the previous terminal:\n\nmyhomepage-58dd9ffb74   1         0         0       28m\nmyhomepage-58dd9ffb74   1         1         0       28m\nmyhomepage-58dd9ffb74   1         1         1       28m</code></pre>\n<h3 id=\"using-github-container-registry\"><a href=\"#using-github-container-registry\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Using Github Container Registry</h3>\n<h4 id=\"login\"><a href=\"#login\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Login</h4>\n<pre class=\"language-text\"><code class=\"language-text\">docker login ghcr.io -u &lt;github account&gt; -p &lt;Personal Access Token&gt;</code></pre>\n<ul>\n<li>github account is not an e-mail address, it is github's self account string.</li>\n<li>To get Personal Access Token, Generate New Token at Account > Settings > Developer Settings > Personal Access Token, and give \"write package\" for authority and get the created token.</li>\n</ul>\n<h4 id=\"example-for-build--push\"><a href=\"#example-for-build--push\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Example for Build / Push</h4>\n<pre class=\"language-text\"><code class=\"language-text\">docker build -t ghcr.io/jinyoung/welcome:v2021101202 .\n\ndocker push ghcr.io/jinyoung/homepage:v2021101202</code></pre>\n<ul>\n<li>Add ghcr.io/ in front of image name when you build.</li>\n<li>Keep the same image name when you push.</li>\n</ul>\n<h4 id=\"check-the-image-and-set-access-authority\"><a href=\"#check-the-image-and-set-access-authority\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Check the Image and Set Access Authority</h4>\n<p>You can check at Account > Your Repositories > Packages</p>\n<p>To set authority, click Setting package, click Set Visibility, set Public at pop-up, then check the name.</p>\n<h4 id=\"details\"><a href=\"#details\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Details</h4>\n<iframe width=\"100%\" height=\"100%\" src=\"https://www.youtube.com/embed/RO3Mw8Gks9Q\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n","sidebar":"started","next":"","prev":"","headings":[{"depth":1,"value":"Application Packaging with Container (Docker)","anchor":"#application-packaging-with-container-docker"},{"depth":3,"value":"How to Utilize Docker Image","anchor":"#how-to-utilize-docker-image"},{"depth":4,"value":"Create an image-based Conatiner","anchor":"#create-an-image-based-conatiner"},{"depth":4,"value":"Delete Container & Image","anchor":"#delete-container--image"},{"depth":4,"value":"Create Image","anchor":"#create-image"},{"depth":4,"value":"Push Image to Remote Registry(Hub.docker.com)","anchor":"#push-image-to-remote-registryhubdockercom"},{"depth":4,"value":"Check the Image created at Docker Hub","anchor":"#check-the-image-created-at-docker-hub"},{"depth":4,"value":"Create a Container based on Docker Hub Image","anchor":"#create-a-container-based-on-docker-hub-image"},{"depth":3,"value":"Packaging Java Application","anchor":"#packaging-java-application"},{"depth":3,"value":"Preview of Next Lab","anchor":"#preview-of-next-lab"},{"depth":3,"value":"Using Github Container Registry","anchor":"#using-github-container-registry"},{"depth":4,"value":"Login","anchor":"#login"},{"depth":4,"value":"Example for Build / Push","anchor":"#example-for-build--push"},{"depth":4,"value":"Check the Image and Set Access Authority","anchor":"#check-the-image-and-set-access-authority"},{"depth":4,"value":"Details","anchor":"#details"}]},"allMarkdownPage":{"edges":[{"node":{"path":"/tool/marketplace/","title":"Template/Topping Marketplace"}},{"node":{"path":"/tool/infrastructure-modeling/","title":"Infrastructure Modeling (Kubernetes)"}},{"node":{"path":"/operations/istio-metric-based-hpa/","title":"[Service Mesh] Istio Metrics based HPA"}},{"node":{"path":"/development/ops-docker/","title":"Application Packaging with Container (Docker)"}},{"node":{"path":"/tool/google-drive-examples/","title":"Google Drive Examples"}},{"node":{"path":"/tool/on-prem-inst/","title":"Installing on-premise MSA-Easy"}},{"node":{"path":"/tool/event-storming-tool/","title":"EventStorming"}},{"node":{"path":"/tool/cloud-ide-tool/","title":"Cloud IDE"}},{"node":{"path":"/tool/development-practice/","title":"Registration Course"}},{"node":{"path":"/tool/attending-lectures/","title":"Attending lectures"}},{"node":{"path":"/operations/ops-persistence-volume-azure/","title":"파일공유를 위한 클라우드 스토리지 활용(Azure)"}},{"node":{"path":"/templates-language/python-template/","title":"Python template "}},{"node":{"path":"/templates-language/springboot-java-template/","title":"Spring Boot/Java Template"}},{"node":{"path":"/tool/chat-gpt/","title":"Chat GPT-based Model Generation"}},{"node":{"path":"/templates-language/go-template/","title":"Go Template "}},{"node":{"path":"/operations/service/","title":"12번가 마이크로서비스 라우터(Service) 생성"}},{"node":{"path":"/operations/ops-utility/","title":"쿠버네티스 유틸리티"}},{"node":{"path":"/operations/service-mesh-ab-testing/","title":"Istio based A/B testing 배포"}},{"node":{"path":"/operations/ops-service-mesh-istio-2/","title":"[Service Mesh] Istio-2"}},{"node":{"path":"/operations/ops-persistence-volume/","title":"파일시스템 (볼륨) 연결과 데이터베이스 설정"}},{"node":{"path":"/operations/ops-service-mesh-istio/","title":"[Service Mesh] Istio"}},{"node":{"path":"/operations/ops-readiness/","title":"셀프힐링 & 무정지 배포 실습"}},{"node":{"path":"/operations/ops-pod-status/","title":"Pod 상태값에 따른 마이크로서비스 트러블 슈팅"}},{"node":{"path":"/operations/ops-persistence-volume-efs/","title":"파일공유를 위한 NAS 스토리지 생성과 설정"}},{"node":{"path":"/operations/ops-persistence-volume-gcp/","title":"파일공유를 위한 클라우드 스토리지 활용(GCP)"}},{"node":{"path":"/operations/ops-liveness/","title":"셀프힐링 실습"}},{"node":{"path":"/operations/ops-ingress-virtualhost/","title":"Ingress - Virtual Host based"}},{"node":{"path":"/operations/ops-label-annotation/","title":"Labels and Annotations"}},{"node":{"path":"/operations/ops-kubernetes/","title":"Kubernetes Basic Command"}},{"node":{"path":"/operations/ops-ingress/","title":"Ingress 를 통한 진입점 통일 - Path-based routing"}},{"node":{"path":"/operations/ops-aws-setting/","title":"AWS Cloud Setup(EKS, ECR 설정)"}},{"node":{"path":"/operations/ops-configmap/","title":"Kubernetes에 환경변수 구성하기"}},{"node":{"path":"/operations/ops-deploy-my-app/","title":"애플리케이션 패키징,도커라이징,클러스터 배포"}},{"node":{"path":"/operations/ops-aws-csi-setting/","title":"AWS Cloud Setup(Container Storage Interface)"}},{"node":{"path":"/operations/ops-autoscale/","title":"Pod Auto Scaling"}},{"node":{"path":"/operations/ops-argo-rollout-canary-istio/","title":"[GitOps] Argo Rollout 와 Istio 를 통한 카나리 배포"}},{"node":{"path":"/operations/ops-anatomy-kubernetes/","title":"쿠버네티스 내부구조 분석"}},{"node":{"path":"/operations/microservice-logging2/","title":"마이크로서비스 통합 로깅 with Loki stack"}},{"node":{"path":"/operations/istio-sre-monitoring/","title":"Service Reliability Engineering"}},{"node":{"path":"/operations/microservice-logging/","title":"마이크로서비스 통합 로깅 with EFK stack"}},{"node":{"path":"/operations/istio-traffic/","title":"[Service Mesh] Istio 를 통한 동적 트래픽 라우팅"}},{"node":{"path":"/operations/k8s-monitoring/","title":"MSA 모니터링 with installing Grafana"}},{"node":{"path":"/operations/istio-resiliency-part2/","title":"[Service Mesh] Istio 를 통한 서비스 회복성 Part2 - 서킷브레이커"}},{"node":{"path":"/operations/istio-msa-telemetry/","title":"[Service Mesh] MSA 모니터링 w/ Istio addon Grafana"}},{"node":{"path":"/operations/istio-resiliency-part1/","title":"[Service Mesh] Istio 를 통한 서비스 회복성 Part1 - 타임아웃/재시도"}},{"node":{"path":"/started/domain-driven/","title":"Domain-Driven Design Learning"}},{"node":{"path":"/operations/end-to-end/","title":"12번가 전체 마이크로서비스의 배포"}},{"node":{"path":"/operations/apply-security-to-12st-mall/","title":"12번가 Mall에 토큰인증 적용하기"}},{"node":{"path":"/started/event-storming-learning/","title":"Event Storming Learning"}},{"node":{"path":"/operations/gitops-argo-cd/","title":"[GitOps] Argo CD 를 통한 카나리 배포"}},{"node":{"path":"/operations/azure/","title":"Azure Cloud Setup (AKS, ACR 설정)"}},{"node":{"path":"/started/","title":"Introduction"}},{"node":{"path":"/development/kafka-connect/","title":"CDC(Change Data Capture) with Kafka"}},{"node":{"path":"/custom-template/unit-test/","title":"Unit Test Creation Topping(New)"}},{"node":{"path":"/custom-template/mock-server/","title":"Open API 3.0-based Mock Server Generation Topping(New)"}},{"node":{"path":"/custom-template/tutorial/","title":"Concept of Custom Template"}},{"node":{"path":"/example-scenario/animal-hospital/","title":"Veterinary Practice Management System"}},{"node":{"path":"/example-scenario/food-delivery/","title":"food delivery"}},{"node":{"path":"/custom-template/designing-template/","title":"Developing Custom Template"}},{"node":{"path":"/example-scenario/accommodation-reservation/","title":"AirBnB"}},{"node":{"path":"/example-scenario/online-lecture/","title":"Internet lecture system"}},{"node":{"path":"/custom-template/custom-template/","title":"Custom Template Objects"}},{"node":{"path":"/example-scenario/library-system/","title":"library system"}},{"node":{"path":"/development/pubsub-idempotency/","title":"Pub/Sub Communication - Choreography with Idempotency"}},{"node":{"path":"/development/understanding-jpa-based-single-microservice/","title":"Understanding JPA Based Single Microservice"}},{"node":{"path":"/development/token-based-auth/","title":"JWT Token-based Authorization"}},{"node":{"path":"/development/pub-sub/","title":"Pub/Sub Communication"}},{"node":{"path":"/development/orchestration-saga/","title":"Orchestration Saga with Axon Framework"}},{"node":{"path":"/development/pubsub-deadline/","title":"Pub/Sub Communication - Choreography with Deadline added"}},{"node":{"path":"/development/oauth2with-keycloak/","title":"JWT Token-based Authorization - Advanced"}},{"node":{"path":"/development/monolith-2-misvc/","title":"MSA Communication by Req/Res"}},{"node":{"path":"/development/kafka-scaling/","title":"Kafka Scaling "}},{"node":{"path":"/development/kafka-scaling-concurrenty-handling/","title":"Kafka scaling & Concurrenty handling"}},{"node":{"path":"/development/kafka-retry-dlq/","title":"Kafka Retry & Dead Letter Queue "}},{"node":{"path":"/development/dp-frontend/","title":"Data Projection with Frontend and HATEOAS"}},{"node":{"path":"/development/kafka-basic/","title":"Kafka Basic Commands"}},{"node":{"path":"/development/gateway/","title":"API Gateway"}},{"node":{"path":"/development/conteact-messaging/","title":"Conteact Test by Message-based CDC"}},{"node":{"path":"/business/eventstorming-fooddelivery/","title":"Food Delivery Example"}},{"node":{"path":"/development/dp-graphql/","title":"Data Projection with GraphQL"}},{"node":{"path":"/development/contract-test/","title":"Contract Test (Consumer Driven Test)"}},{"node":{"path":"/development/dp-cqrs/","title":"Data Projection with CQRS"}},{"node":{"path":"/development/compensation-correlation/","title":"Pub/Sub Communication - Compensation & Correlation"}},{"node":{"path":"/development/choreography-saga/","title":"Choreography Saga with Axon Framework"}},{"node":{"path":"/development/cna-start/","title":"Running Microservice Units"}},{"node":{"path":"/development/circuit-breaker/","title":"Circuit Breaker for Req/Res"}},{"node":{"path":"/contact/question/","title":"CONTACT"}},{"node":{"path":"/business/ddd-google-drive/","title":"Google Drive Example"}},{"node":{"path":"/business/","title":"Shopping Mall Example"}}]}},"context":{}}