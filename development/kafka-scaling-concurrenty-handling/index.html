<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Kafka scaling &amp; Concurrenty handling - msaez</title><meta name="gridsome:hash" content="fa5fedf1848133ded319caa58f5dc027d2a72899"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="og:url" name="og:url" content="undefined/templates-language/springboot-java-template/"><meta data-vue-tag="ssr" name="description" content="undefined"><meta data-vue-tag="ssr" data-key="og:title" name="og:title" content="Kafka scaling &amp; Concurrenty handling"><meta data-vue-tag="ssr" data-key="twitter:title" name="twitter:title" content="Kafka scaling &amp; Concurrenty handling"><meta data-vue-tag="ssr" data-key="og:description" name="og:description" content="undefined"><meta data-vue-tag="ssr" data-key="twitter:description" name="twitter:description" content="undefined"><meta data-vue-tag="ssr" data-key="og:type" name="og:type" content="website"><meta data-vue-tag="ssr" data-key="twitter:card" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" data-key="og:image" name="og:image" content="undefined/logo.jpg"><meta data-vue-tag="ssr" data-key="twitter:image" name="twitter:image" content="undefined/logo.jpg"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.f0886199c685a75a52fccefb5e72c094.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.f0886199c685a75a52fccefb5e72c094.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.f0886199c685a75a52fccefb5e72c094.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.f0886199c685a75a52fccefb5e72c094.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.f0886199c685a75a52fccefb5e72c094.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.f0886199c685a75a52fccefb5e72c094.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.f0886199c685a75a52fccefb5e72c094.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.f0886199c685a75a52fccefb5e72c094.png"><link rel="preload" href="/assets/css/0.styles.7b914b4e.css" as="style"><link rel="preload" href="/assets/js/app.1663a9ab.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--markdown-page-vue.eef38ce3.js" as="script"><link rel="prefetch" href="/assets/js/page--src--pages--404-vue.e7647be7.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.ba039b97.js"><link rel="prefetch" href="/assets/js/search.395cc609.js"><link rel="prefetch" href="/assets/js/vendors~search.1cb8046c.js"><link rel="stylesheet" href="/assets/css/0.styles.7b914b4e.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div data-server-rendered="true" id="app" class="font-sans antialiased text-ui-typo bg-ui-background"><div class="flex flex-col justify-start min-h-screen"><header class="sticky top-0 z-10 w-full border-b bg-ui-background border-ui-border"><div class="py-2 border-t-2 border-ui-primary"><div class="container"><div class="flex items-center justify-between -mx-2 sm:-mx-4"><div class="flex flex-col items-center px-2 mr-auto sm:px-4 sm:flex-row"><a href="/" title="Home" class="flex items-center text-ui-primary active"><img src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 120 64' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-37afcb0017f229c304bfe602273e7d7c'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-37afcb0017f229c304bfe602273e7d7c)' width='120' height='64' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAiCAYAAADvVd%2bPAAAACXBIWXMAAC4jAAAuIwF4pT92AAATu0lEQVRo3sVZB3RU15lWIxhscMtunHhd8EkcJzFusb1xwMaAuoQkpFEFUWQwzXEMAQSYElFEkVCbGUmjikZdIJBAqIxmRgUJVRAqmGLABQdwTBDqZebdb/97Z0YIO1nvnrN7mHO%2b89/35pX5vvu3e8fKij69eQ4C48ffg7UZNgK5DrY9ufZ2wtJ5qwfw0cirrDSKahuCrRk0rrKuUFRb05h/Z1VhukZcP378g09vnr2VmZwtR4/Z8nNE9Ed/DAlhRfdM%2bS7X/QXkv/rWtrQ6R2cVW%2bSVNBDkoRoK9EwaCvBMGvQn60fwJcgIPnRuvkfSkBeNPWns4aEadCfrRseudN5lvmrAZU6SZJ%2bobA/Ry3XLyhXV7xPBXxGRh/%2b731PxQ3FsK%2bTi2Fojrx4TQtievP8BQSJHBJ8h%2bzrBje5ZQTaMhEulcTmN2%2bn7G925zgNS/n9K0enF3S5qwC8T8LFAfT9kZojjDMDbgkP34ENwIySnXkNraiN0CfUgAQbph39DaCQyeWT3EuHlhDk0/hXZx36MDxdovOUEnyC8SiQcyS4mbOnNtY8nW0K2lfAFobc/3wGGo05AsTNwwpXgBlbsIs4NHXZEb74zjPnvQJ2ROmKvgmF%2bUr%2bBZpQwZKDZFdaLjt0T%2bgyO8l6jo7zP6KzoNXok9hvpvJG8xUjXE8iqBgXck4alQ8ozxiq5zkAeIFUqa6BPqENNUiPqU1twOu0M6lKaUa06DRJghEhdJ9tMOMzFISwjOBB%2bTZh6T4Tq%2b1w4khU5Y6DAETjuQsRcTJbIGY%2b5YOiIM/oLnECCMAoJqTfP0XA3Z67hTsYfCTMMPbkORvpO6s51Yoa8P7JydTgcVWBeSf2MCDEiT3aI7ACzVwyyoBywtSVg60%2bCfXQcbH46mKNigK7n1wyJe4g8m0fH3nTPYUUj08n1jGafaUyQiKiRrIGsoeSgxngiUiOVx%2bpRlViPWhKHi3I6tZVEahXnuDiEvxHOE%2baYQ8DGIsBfOGma5REiQoTsDdxyknfVfzT2Z8%2bQutUzGHkI4yLczX6fjRx1ZWjczFC3FgN5c0iYuexunhNG8mayM1l/Zm4qIycCQSZpCB6JA5iXNIq4GiNi0ouxdsNWfLx2Azbt2IeUomZsLQOclIMgTwCJABIANPsIVPWgRFGLSnkVd39OBERaCFEep4dGXsM6T1xkFzRXWP2hFlYarZPoOyMXhgtEiZFbqVJRA62yFo3pbXR/tbNZAFshAM2gB3djImck8pwkiDyjmWcjDXvw93oFjLXr0Zv9Pj%2bPkWIvdGiS4ecfiDVr/oRvT8WiP3c2unMd2WDeLFzNCWZ%2bSXfZPNUwF0CQcoofRkLNABb6eYJeeR9%2bYm2FvZFyfFQEOCv76XqTAK5JI1iWeJtIVnHS4wWgcRU0cdVo03ZgzUdr4ObuhqK8YjTlnEVptNbiKXQvt0IwSdwrckjVS9/zAPtX%2b4h0r2WGcx2I0CzcOhUHV68ATHniKWzf8VdIdZvxj5RXITXtwRyne0T2hG0FqpbhH%2br30Jdnj9u57vgg%2bSu4qIxEZgDOij6sJnI790aZ77HGc88/D4c5s/DitKfFueAAH%2bypAubG9QnBvEgAZ/KYtYk3QBVAkK8wk9coq3EiogIXyj/Hnz7%2b09jvePq5X%2bBM5TlUxJgEEteaReMC8NxB9ibhSbMA1pYk%2bBTh9iDlAB7Ld7LeB8p9kZW4995M2U5GV2UyjHnv4FZNFJ5%2b/sWx75xc3IGG7ejOeAc9FAaDebOxPvUcnFQM3skDsCdSYVrAV%2bYtrqe3Iv%2b4Hse%2bBGLKbmK3IhcJFX%2bDd6oB81Q8bIaEAE4kwLaEL1Aj16LcLAAnw12/WtUA/YkqTJg4QQg6wW6CePaRjKOoS21GWaxuPHnuAcYauodE6Rgrg5ZEaK77nZYwuJNJAlQEID0uTDx00kMThd26eQNQvxJtxfsxYfLj45R/EX%2bvjUZ/9kx05zljNG8mDqSVw0FF5SypHw7yPoRSjK9eY5otG1tbTJ/%2bCjaHxyO%2b/BtENwMOCRLcE/oFeUqaYx5wIP7iPQHGzf4l3VX4%2bvmanmdjAzs7O7M3huNsQSdORlWOCVAhNwlwKrmJH580l0BrSx9gY06EpbwSmAVgqAhEauxO8VA7O1thX3jpFaArGcXJ2%2bnYZlwc/wS1R6IgFbngdraj8JJDhw5hLglApVAkQK9UBrXmMn75H0/cF///9thD%2bGjVCiTV9sFNNUKxPyBEsOQAaoJQZRaAk%2bEzW5/WguL847CyNj3DP8Afb775phgHBgbifNlllERqxvKFWQgDrwpklUIARZWtEIB3fOYwUPLSx7P/ncxZgCYIqqi/iodOmGAnwMe1ZflIVR4Q45df/h0ef/wxMY4O/xTQLsJ3mbNFL1Cq3sdLIcWzKam5xvcjOJshobgD/rL5eOZnj90nxKrlS7GbwsRe3i9yABeAyiCylS0iB5TLq8Xsl0RocKn6Khwc7cV9EydOxMWOi/Dy9BLHr73xKs5VdKIsalwIiKpRZeA9Ax1vMMe/ncUDzALYrxWl0CQAQ%2bVCKCO2i4c%2b9dTP4OnhIcZLQ5ZhY2ioGIeGbsK7774rxgEBgZQHNuN2xkyM5L%2bHlqy1cFeNjlUB14RBEgDYcwpQtALyir9jx/54/PQJUyg9%2begkJJR9SbNOiVM1IMjLVP04qjgNrVwv4v9kdCWas9qQmZo1JpyrmytGuw1YtWKVOJ7y6BToi2qgU9bR7OvHl00j7w/oOf7fL4G25hDwko5ZQoALEIy4/dtMbvrTJ3HsWLGItUcfnYpp06aJ88XHCvHh8uVi/NL036O7LhI9WTOpL5iNKzmLIEvqhQfVcj77Kw8DyowiBPnLsDu%2bENHlt1F%2b5hZeefm34v5HH54A5YmLmJfCSIB%2bCodhLErsRin1ABpz7Jce1OJCzWW88ebrYwLYUfKbNu15PPPsM2PnUpSpaFJTOYzRmgQwlUGmja/lx3%2bwlECzBzjYmEPgDXMZxJ3M9xh35%2bjwreKBDz00Cd9c6YCri5M56ViLHHCp/ggU%2b03XTJryBGs7GQdDoT3rz7dnd3Jd2AfJX1MzY2C8tMnrgHffnm66n/D8009i6iOTxn60y5wZiKk2Yq58kHknk8ckG9kq1W1mnn1WElXJ2g6fR1yU3PQMaxtMpOQ8cfLEsWfY2ppy1bpP1qG96AKoQxyrAryF1pjWEc9YSqBoh3vNy1kS4t8pHLoHqKcnASRol7DI3Z9ayOFWSzYKUvaPvWzi1J%2bhpzUJukyRKBlHbPgmSOXB0lfy6axAsYknM9ENcg9YXgCosk7gtd88B7txsT/RlsjPnQl15efwPcTYvERqiVW8ctyR1sZclKoVep4AWUVsFdprOjHtxWlj9xYVFAt3z07JwY6tOzB58mRTWXZ2wnmNSIRi5ikEJF0CD4mqL%2bj4ke/3AJZ22I7GF0YKnXFH/a4E/VIWtuUT88sm4sLJfRhqjMCiZWvw%2b7dnQBF7EJJ%2bNb6sjMD7rv7s3VmzkZGWIn2e4YfCXZ6QJXZL85JHqAz2Md4LuJAIHx6h2NcPIiK7CfsT8nFAVYD4oy2IqzVAdshIOWOAucXdwtwdTdI721vx6f561MRXSWWiqalmLaVtKMopRtS%2baCTGJ6L95GfQxp0S/f71MzcoDF8Sv3fq41PRUNLMKuNqxMxTCzzK1wZE%2bizn2nTo3L29Ab7eH/OCXIdyvrojDzCgcjGRjMKvf/caZEEhuF4bj%2bH8WaIbNDbuAXTL0JM5A/0ngjHaEoEbpaHSxewQtOz%2bzTerFU2pjqnU28cbpbnxYPbxIHIGeCTcxaK0r7D%2byDdYkAsEZQGeKcCcGAluSgN5DHWCu65Is7e04q3QlvbMyLq6hsRGEBGpMo5qeUw1TiU3oyW7HWfyO6gk6kWio4UQTqkboSmqRPS%2bGGzaFMpOVzSxshgdjkeVGYoiS8V1ZHdxnof3FtmMXwqLRsg8TuCVQCyG8p1Yb00Yhhv2AY3bMXDMB3ezqd9Xz8DdjD9wkajrcyQRZqEn/Q%2bs/q/TUfHpa7i2Y/J7ATmG5esKv8POww2G5JJjrESbgDP12/F162o20uWDr5rWMO%2b0a8yn8DjzP6JBwJEa5lvQAN%2b8s8w9vgLOUSfhrM5aWnjo%2bMky9SkUJdJqL0HLSuN1KJPrGFUDgXEZHnwlSJ0ea8lpZ53FF3E0%2bgSTr08YTd2WAcWGxMHotfLFltnftTL8BxsetuY8sMHSC4hFURatANXvsDu8xc2ZLdYJRJrgxFeGUm%2bBg9RX7MJ6S93ZdfKcm1r324aLvvqecwu6Bzr8YOhwZaxjDkPnbOAzdxjPe8Jw3oN1t4Vg5dFTWFC9E0uqd7HF1buwuHo3FmjD2ELdHgTrw43Bur1scdVBLNVFsg%2b0B7FCE81Wl8fiz6UKdlRVYdDKawyU3fmqT7q3OtQxnvmPR5Qb4zcmSenbMxEfmtSYuDnlRc6vOaPdOnz1/vs3Q3pMe34WD5hvpFJI5EfFyjDPicPA1/9mUfi6H/0FDhjimyM6dwx/JmPD52Ug4ky67A9c8QEuuAGfyxi%2bDgFuUvt8YyOGaeYHO2VsiOxohz/bUZrd76eNYot1kQjWRrIg3QGsaVVhdUsiW96oQMjpWCyoiWB%2bleEkyAG2UH8AgVX72BJ9JDTqOjSmnEVtciP0CfWoVIryxpOdQRd/auRY5EmoNqciYVNypGWSlRtVdiSGZXzfbpDYD7SUwkGqAhyjtC7grTHfFLFskBiPibUCx0BPtv3XfSddLnHyQ50%2bBBkG2z0Zu7bG2H01RTpTk4Dighi2J2wD2xW2DX1XDmCkcx4b6PQDzntJmQ1/OS/TRklLiViQbj%2bLbi6APCuZRWUmQHE4nSmLM5i6rpjtbctDYCV5gz6SPCUSIdqDdwuTyg9o42oyyANqiTjP7AN8rc/zQ2P6WaRtU9%2bKWadws5An4rYW4hYRvh8C1mb7C8JNwrdUEtvJaqk6ZJDdTZ7C9wE9qGN8m1z/%2bW8/fMVu6Jz3NCI/NEoiDLR7M1wJRIM%2bFT9/5mXKxrb3St0jv8D1LjWkC57o7/BlJADyGz8xkAAsuHIvVjQpWUZR3n2t8aQJEzHJegKiE%2bVY15aKQE24tLQumnvD1fv29xRVD5EAz9KMzqCMv6AkWrOZZv9Z/l3iphRbImxtFsGKPOKfbxJaNkaJHN8ZfpaOn6Txj253D1/yfWi4S3YFl/3Q1%2bYp4cYKpCbsFgR%2b%2b9uXUHQkFV2tJzB6tw34ZiMGzrmxwS7hAexQw3r4aKNAHsACdfsQ1VoAZX4aEnLTsHLlyjEhFNkpWNOSiCDNXuPS%2bhgs0kV05aaW2DUcbLQ5mJfzL3%2bjZdZ/lPz4rfF/5hm8U%2bTrBfresl1u03vUyXqg1kOEDQmgwxcB3AOMuBbIasqU4oe//tprqNEeQUzEpwhe4IfTmjjgajDr455yfj7i60MZCUAxfQCL9BHMXxOO1W0q6L48g7feMK3swnaGIfryccjKKUnqI408LwTrIk7z966siLVWqQutzP8BUFdXZVOpqLE9GVNpm/xpuhAmb0/hjxO/rxka/ydI7g//IOkR5%2bytyO05caEwxb4KXwVisENmYBe92NWzKkx%2b5Kc/2PZKT9oPXF%2bBvnNeYF3z2cG6LYxCAEIASoABur3Iv6DHrHdmiuuXLQlB2tVK%2bFRw8hFE/IAxpCGOi1XO30vWms5ZBBC/nxKgFVUBq5xdBeK4cP/x/59/ZYY7ZWMCkP2ECzDU6WsY6XRF3zUFXvilqedXxh3A9YslGL7TAgwVstHz89kgJUzpMx8WXreN%2bVJ5W0qzL9PshvqaDouCFor7fLy8UXyjCX41%2b3gCFB5CZA0fNMZxIXL5e8nacAEeyIdI3xOgU%2baKq/4Y6vI1Dp5zZrh5EHPmmhZN0ZF7kK%2bOwIchPliyZAn7x6VYIj%2bP3WnxxpbqHQjURzH/it3Y1ZWHzVu3iHsmP/wwktNSkFqej3R9Idvdms0CtXt5CIwua1ZwMUQaX1QVaUtjqwf2IQFEDhjqkv2OavzoyHlf9J11ZfhuB1auWvP9EGDP/fItfNGexq5o5qC2wElaVblrMLg6iuJ7J1NeKkGgt98PwoZewLLKjmBZo1xaoNk3%2bkGTHEFl4aH8vUGle2wftAdYm8Y%2bU2l8Q7roR3nARyJLeSCJ7dgWyhTR21FRFMsutaaykb%2blse5ziw1njs6G9qjHroCq6Mshp6K4S0tLa6JYWlsJk%2belsMg0BYtMjGWb92xnO8J3Ql5fYHTP3Ajv7C20tF471ti4xn/8QGd/DObjRlzxp25PZhzsmM%2bki74Svv2LETc/MuDLhQZc8jZKn7kZBju80JA3J/vnl5unUOLrXVwVyV3asFC73xig32dY3qQwfNSqMmxoPzS6uTPTsPVCzohfcRhcEv4Mt8RPVo%2bRV5rIU1l8sCJQNbAxVwI1rvnzjnB4hJoi4wVfsAteprb4C2qPPydcDcTNBq/O9t9Y/URWp3xhMWX/pXUx4M1NSEMsd3MsJcux%2bDQ1PHVRWNQQDc%2bM0H4X5ccu/D00tvVI3yA8z0sdahV4YveDE2BIVAIfO7MYu3B3MXhDRCIY6PjWcJdvM9kcQhghkM7/J7uyYAq/fr12%2b%2bRgfcTvyQveJw9wpzAIIruKsJGwkxBD3pG2sGJfjkfahtf5PfPS1tvNS1on3u2mWmvlmbLe6oF/7uUB2duErQR3wnTCo//qnqpyX5v/7Xvck9eNdXWc/P/l578AjufF27Pdj9IAAAAASUVORK5CYII=' /%3e%3c/svg%3e" width="120" data-src="/assets/static/logo.1539b60.bd727e13501e82a0ba322b4ad29fd33a.png" data-srcset="/assets/static/logo.1539b60.bd727e13501e82a0ba322b4ad29fd33a.png 120w" data-sizes="(max-width: 120px) 100vw, 120px" class="text-ui-primary g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/logo.1539b60.bd727e13501e82a0ba322b4ad29fd33a.png" class="text-ui-primary g-image g-image--loaded" width="120"></noscript></a></div><div class="w-full px-2 sm:px-4 max-w-screen-xs"><!----></div><div class="flex items-center justify-end px-2 sm:px-4"><!----><!----><!----><div class=".clearfix" style="width:250px;"><div style="width:55px; height:50px; text-align:center; line-height:50px; font-weight:700; float:left;"><a style="cursor:pointer;">English</a></div><div style="width:50px; height:50px; text-align:center; line-height:50px; float:left; padding-top: 5px;"><button aria-label="Toggle Darkmode" title="Toggle Darkmode"><svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></button></div><div style="width:130px; height:50px; text-align:center; line-height:50px; float:left;"><a href="http://labs.msaez.io/" target="_blank" rel="noopener" class="px-4 py-2 ml-auto font-bold leading-none text-white rounded-lg shadow-lg bg-ui-primary">
              Try MSAEZ
            </a></div></div></div></div></div></div></header><main class="container relative flex flex-wrap justify-start flex-1 w-full bg-ui-background"><!----><div class="w-full pb-24"><div class="flex flex-wrap items-start justify-start"><div class="order-2 w-full md:w-1/3 sm:pl-4 md:pl-6 lg:pl-8 sticky" style="top:4rem;"><div class="mt-8 sm:pl-4 md:pl-6 md:pt-12 lg:pl-8 sm:pb-16 sm:border-l border-ui-border md:mt-0"><h3 class="pt-0 mt-0 text-sm tracking-wide uppercase border-none">On this page</h3><div><ul><li class="font-semibold depth-2"><a href="/development/kafka-scaling-concurrenty-handling/#kafka-메시지-동시성-처리" class="relative flex items-center py-1 text-sm transition transform hover:translate-x-1"><span class="absolute w-2 h-2 -ml-3 rounded-full opacity-0 bg-ui-primary transition transform scale-0 origin-center"></span>
          Kafka 메시지 동시성 처리
        </a></li><li class="depth-3"><a href="/development/kafka-scaling-concurrenty-handling/#주문-배송서비스-실행" class="relative flex items-center py-1 text-sm transition transform hover:translate-x-1 pl-2"><span class="absolute w-2 h-2 -ml-3 rounded-full opacity-0 bg-ui-primary transition transform scale-0 origin-center"></span>
          주문, 배송서비스 실행
        </a></li><li class="border-t border-dashed border-ui-border pt-2 mt-2 font-semibold depth-2"><a href="/development/kafka-scaling-concurrenty-handling/#test---싱글-파티션-싱글-컨슈머-환경" class="relative flex items-center py-1 text-sm transition transform hover:translate-x-1"><span class="absolute w-2 h-2 -ml-3 rounded-full opacity-0 bg-ui-primary transition transform scale-0 origin-center"></span>
          Test - 싱글 파티션, 싱글 컨슈머 환경
        </a></li><li class="border-t border-dashed border-ui-border pt-2 mt-2 font-semibold depth-2"><a href="/development/kafka-scaling-concurrenty-handling/#test---멀티-파티션-멀티-컨슈머-환경" class="relative flex items-center py-1 text-sm transition transform hover:translate-x-1"><span class="absolute w-2 h-2 -ml-3 rounded-full opacity-0 bg-ui-primary transition transform scale-0 origin-center"></span>
          Test - 멀티 파티션, 멀티 컨슈머 환경
        </a></li><li class="border-t border-dashed border-ui-border pt-2 mt-2 font-semibold depth-2"><a href="/development/kafka-scaling-concurrenty-handling/#1-처리순서가-지켜지지-않는-메시징" class="relative flex items-center py-1 text-sm transition transform hover:translate-x-1"><span class="absolute w-2 h-2 -ml-3 rounded-full opacity-0 bg-ui-primary transition transform scale-0 origin-center"></span>
          1. 처리순서가 지켜지지 않는 메시징
        </a></li><li class="depth-3"><a href="/development/kafka-scaling-concurrenty-handling/#동일한-주문이-여러-파티션에-랜덤하게-적재되는-경우" class="relative flex items-center py-1 text-sm transition transform hover:translate-x-1 pl-2"><span class="absolute w-2 h-2 -ml-3 rounded-full opacity-0 bg-ui-primary transition transform scale-0 origin-center"></span>
          동일한 주문이 여러 파티션에 랜덤하게 적재되는 경우,
        </a></li><li class="border-t border-dashed border-ui-border pt-2 mt-2 font-semibold depth-2"><a href="/development/kafka-scaling-concurrenty-handling/#2-처리순서가-보장되는-메시징" class="relative flex items-center py-1 text-sm transition transform hover:translate-x-1"><span class="absolute w-2 h-2 -ml-3 rounded-full opacity-0 bg-ui-primary transition transform scale-0 origin-center"></span>
          2. 처리순서가 보장되는 메시징
        </a></li><li class="depth-3"><a href="/development/kafka-scaling-concurrenty-handling/#동일한-주문이-동일-파티션에-적재되는-경우" class="relative flex items-center py-1 text-sm transition transform hover:translate-x-1 pl-2"><span class="absolute w-2 h-2 -ml-3 rounded-full opacity-0 bg-ui-primary transition transform scale-0 origin-center"></span>
          동일한 주문이 동일 파티션에 적재되는 경우,
        </a></li></ul></div></div></div><div class="order-1 w-full md:w-2/3"><div class="content"><h1 id="kafka-scaling--concurrenty-handling"><a href="#kafka-scaling--concurrenty-handling" aria-hidden="true"><span class="icon icon-link"></span></a>Kafka scaling &#x26; Concurrenty handling</h1>
<h2 id="kafka-메시지-동시성-처리"><a href="#kafka-%EB%A9%94%EC%8B%9C%EC%A7%80-%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%B2%98%EB%A6%AC" aria-hidden="true"><span class="icon icon-link"></span></a>Kafka 메시지 동시성 처리</h2>
<ul>
<li>Kafka 파티션 스케일아웃에 따른 동시성 이슈를 확인한다.</li>
<li>컨슈머 측에서 순서가 보장되기 위한 설정을 이해하고 실습한다.</li>
<li>CODE > ProjectIDE로 GitPod 실습환경을 실행한다.</li>
</ul>
<h3 id="주문-배송서비스-실행"><a href="#%EC%A3%BC%EB%AC%B8-%EB%B0%B0%EC%86%A1%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%8B%A4%ED%96%89" aria-hidden="true"><span class="icon icon-link"></span></a>주문, 배송서비스 실행</h3>
<ul>
<li>카프카 실행상태를 확인하고, 사용할 MySQL DB를 시작한다.</li>
<li>주문, 배송 마이크로서비스를 실행하고, 주문에 따른 배송 프로세스를 확인한다.</li>
</ul>
<pre class="language-text"><code class="language-text">cd mysql
docker-compose up -d

cd order
mvn clean spring-boot:run

cd delivery
mvn clean spring-boot:run</code></pre>
<h2 id="test---싱글-파티션-싱글-컨슈머-환경"><a href="#test---%EC%8B%B1%EA%B8%80-%ED%8C%8C%ED%8B%B0%EC%85%98-%EC%8B%B1%EA%B8%80-%EC%BB%A8%EC%8A%88%EB%A8%B8-%ED%99%98%EA%B2%BD" aria-hidden="true"><span class="icon icon-link"></span></a>Test - 싱글 파티션, 싱글 컨슈머 환경</h2>
<ul>
<li>새로운 터미널에서 카프카 토픽을 실시간 모니터링한다.</li>
</ul>
<pre class="language-text"><code class="language-text">cd kafka
docker-compose exec kafka /bin/bash
cd /bin
./kafka-console-consumer --bootstrap-server localhost:9092 --topic kafka.scaling --from-beginning</code></pre>
<ul>
<li>새로운 터미널을 오픈해 주문을 실행한다.</li>
<li>PARK(id: 1000) 주문에 이어, KIM(id: 2000) 주문도 생성한다.</li>
</ul>
<pre class="language-text"><code class="language-text">http :8081/orders customerId=1000 productId=100 productName=TV qty=3 address=SEOUL
http :8081/orders customerId=2000 productId=100 productName=RADIO qty=3 address=PUSAN</code></pre>
<ul>
<li>KIM이 배송지 정보를 수정(PUSAN > SEOUL)한다.</li>
<li>주문수정이 일어나면 배송서비스에서는 10초의 딜레이가 발생하도록 설정되어 있다.</li>
</ul>
<pre class="language-text"><code class="language-text">http PATCH :8081/orders/2 address=SEOUL</code></pre>
<ul>
<li>KIM이 주문을 삭제한다.</li>
</ul>
<pre class="language-text"><code class="language-text">http DELETE :8081/orders/2</code></pre>
<ul>
<li>컨슈머가 하나일 때는 싱글 스레드로 동작해 설정된 딜레이 시간이 경과된 후 수정,삭제가 일어난다. </li>
<li>'배송수정(DELIVERY MODIFIED)'에 이어 '배송취소(DELIVERY CANCELLED)' 이벤트가 카프카에 수신되었다. </li>
<li>새로운 터미널에서 데이터베이스를 조회해 보자.</li>
</ul>
<pre class="language-text"><code class="language-text">cd mysql
docker-compose exec -it master-server bash
mysql --user=root --password=1234
use my-database;
select * from Delivery_table;</code></pre>
<ul>
<li>배송서비스 테이블에 최종 배송취소 상태값(DELIVERY CANCELLED)이 정상적으로 조회된다.</li>
</ul>
<h2 id="test---멀티-파티션-멀티-컨슈머-환경"><a href="#test---%EB%A9%80%ED%8B%B0-%ED%8C%8C%ED%8B%B0%EC%85%98-%EB%A9%80%ED%8B%B0-%EC%BB%A8%EC%8A%88%EB%A8%B8-%ED%99%98%EA%B2%BD" aria-hidden="true"><span class="icon icon-link"></span></a>Test - 멀티 파티션, 멀티 컨슈머 환경</h2>
<p><u>12st Mall 사용량이 증가해 카프카와 배송서비스를 증설(스케일 아웃)할 필요가 생겼다고 가정해 보자. </u></p>
<ul>
<li>열린 카프카 터미널에서 파티션을 2개(default 1)로 Scale Out 한다.</li>
</ul>
<pre class="language-text"><code class="language-text">./kafka-topics --bootstrap-server 127.0.0.1:9092 --alter --topic kafka.scaling -partitions 2
./kafka-topics --bootstrap-server 127.0.0.1:9092 --topic kafka.scaling --describe</code></pre>
<ul>
<li>새로운 터미널에서 두번째 배송 서비스를 실행(Scale Out) 한다.</li>
</ul>
<pre class="language-text"><code class="language-text">cd delivery-2nd
mvn clean spring-boot:run</code></pre>
<h2 id="1-처리순서가-지켜지지-않는-메시징"><a href="#1-%EC%B2%98%EB%A6%AC%EC%88%9C%EC%84%9C%EA%B0%80-%EC%A7%80%EC%BC%9C%EC%A7%80%EC%A7%80-%EC%95%8A%EB%8A%94-%EB%A9%94%EC%8B%9C%EC%A7%95" aria-hidden="true"><span class="icon icon-link"></span></a>1. 처리순서가 지켜지지 않는 메시징</h2>
<h3 id="동일한-주문이-여러-파티션에-랜덤하게-적재되는-경우"><a href="#%EB%8F%99%EC%9D%BC%ED%95%9C-%EC%A3%BC%EB%AC%B8%EC%9D%B4-%EC%97%AC%EB%9F%AC-%ED%8C%8C%ED%8B%B0%EC%85%98%EC%97%90-%EB%9E%9C%EB%8D%A4%ED%95%98%EA%B2%8C-%EC%A0%81%EC%9E%AC%EB%90%98%EB%8A%94-%EA%B2%BD%EC%9A%B0" aria-hidden="true"><span class="icon icon-link"></span></a>동일한 주문이 여러 파티션에 랜덤하게 적재되는 경우,</h3>
<ul>
<li>KIM(id: 2000)이 주문을 생성한다.</li>
</ul>
<pre class="language-text"><code class="language-text">http :8081/orders customerId=2000 productId=100 productName=RADIO qty=3 address=PUSAN</code></pre>
<ul>
<li>KIM이 배송지 정보를 수정(PUSAN > SEOUL)한다.</li>
</ul>
<pre class="language-text"><code class="language-text">http PATCH :8081/orders/{order-id} address=SEOUL</code></pre>
<ul>
<li>KIM이 주문을 삭제한다.</li>
</ul>
<pre class="language-text"><code class="language-text">http DELETE :8081/orders/{order-id}</code></pre>
<ul>
<li>'주문수정'과 '주문취소' 메시지는 라운드로빈으로 각각 다른 파티션에 저장된다. </li>
<li>배송 서비스는 각 매칭된 파티션으로부터 이벤트를 수신하여 동시성 처리가 일어난다.</li>
<li>이때, 한 배송 서비스가 '주문수정' 이벤트를 수신하여 딜레이(10초)만큼 대기하는 동안에,</li>
<li>다른 배송 서비스가 '주문취소' 이벤트를 수신하여 해당 배송정보를 먼저 삭제 처리해 버린다.</li>
<li>이는 곧, 고객에 의해 삭제 처리된 배송정보에 대해 배송수정 로직을 적용하는 모순이 벌어지게 된다. </li>
<li>카프카 컨슈머로 토픽을 조회해 보자.</li>
</ul>
<pre class="language-text"><code class="language-text">./kafka-console-consumer --bootstrap-server localhost:9092 --topic kafka.scaling --from-beginning</code></pre>
<ul>
<li>'DeliveryCancelled' 이벤트가 'DeliveryModified' 이벤트보다 먼저 카프카에 퍼블리시 되었다. </li>
<li>데이터베이스를 조회해 보자.</li>
</ul>
<pre class="language-text"><code class="language-text">select * from Delivery_table;</code></pre>
<ul>
<li>삭제되어야 할 배송정보가 수정된 채로 조회되고 있으며, 이는 메시지 처리 순서상 문제가 발생했음을 알 수 있다. </li>
</ul>
<h2 id="2-처리순서가-보장되는-메시징"><a href="#2-%EC%B2%98%EB%A6%AC%EC%88%9C%EC%84%9C%EA%B0%80-%EB%B3%B4%EC%9E%A5%EB%90%98%EB%8A%94-%EB%A9%94%EC%8B%9C%EC%A7%95" aria-hidden="true"><span class="icon icon-link"></span></a>2. 처리순서가 보장되는 메시징</h2>
<h3 id="동일한-주문이-동일-파티션에-적재되는-경우"><a href="#%EB%8F%99%EC%9D%BC%ED%95%9C-%EC%A3%BC%EB%AC%B8%EC%9D%B4-%EB%8F%99%EC%9D%BC-%ED%8C%8C%ED%8B%B0%EC%85%98%EC%97%90-%EC%A0%81%EC%9E%AC%EB%90%98%EB%8A%94-%EA%B2%BD%EC%9A%B0" aria-hidden="true"><span class="icon icon-link"></span></a>동일한 주문이 동일 파티션에 적재되는 경우,</h3>
<ul>
<li>멀티 파티션, 멀티 컨슈머 환경에서 처리순서가 보장되려면, 키(Key)와 함께 이벤트를 퍼블리시 한다.</li>
<li>카프카 파티셔너는 동일한 키에 대해 동일 파티션에 이벤트를 적재해 준다.</li>
<li>이를 적용해 보자.</li>
<li>주문 서비스에서 Order id를 메시지 키로 하여 퍼블리시 되도록 Key를 추가한다.</li>
<li>Order > Order.java 포트 메소드에서 아래대로 수정한다.</li>
</ul>
<pre class="language-text"><code class="language-text"># 34,40,49 line modify
orderPlaced.publishAfterCommit(getId());</code></pre>
<ul>
<li>아래 코드를 복사하여 Order > AbstractEvent.java 62라인에 추가한다.</li>
</ul>
<pre class="language-text"><code class="language-text">    public void publish(String messageKey) {
        /**
         * spring streams 방식
         */
        KafkaProcessor processor = OrderApplication.applicationContext.getBean(
            KafkaProcessor.class
        );
        MessageChannel outputChannel = processor.outboundTopic();
 
        outputChannel.send(
            MessageBuilder
                .withPayload(this)
                .setHeader(
                    MessageHeaders.CONTENT_TYPE,
                    MimeTypeUtils.APPLICATION_JSON
                )
                .setHeader(&quot;type&quot;, getEventType())
                .setHeader(KafkaHeaders.MESSAGE_KEY, messageKey.getBytes())
                .build()
        );
    }

    public void publishAfterCommit(Long messageKey) {
        TransactionSynchronizationManager.registerSynchronization(
            new TransactionSynchronizationAdapter() {
                @Override
                public void afterCompletion(int status) {
                    AbstractEvent.this.publish(String.valueOf(messageKey));
                }
            }
        );
    }</code></pre>
<ul>
<li>주문서비스를 재시작한다. </li>
<li>KIM(id: 2000)이 주문을 생성한다.</li>
</ul>
<pre class="language-text"><code class="language-text">http :8081/orders customerId=2000 productId=100 productName=RADIO qty=3 address=PUSAN</code></pre>
<ul>
<li>KIM이 배송지 정보를 수정(PUSAN > SEOUL)한다.</li>
</ul>
<pre class="language-text"><code class="language-text">http PATCH :8081/orders/{order-id} address=SEOUL</code></pre>
<ul>
<li>KIM이 주문을 삭제한다.</li>
</ul>
<pre class="language-text"><code class="language-text">http DELETE :8081/orders/{order-id}</code></pre>
<ul>
<li>카프카 컨슈머로 토픽을 조회해 보자.</li>
</ul>
<pre class="language-text"><code class="language-text">./kafka-console-consumer --bootstrap-server localhost:9092 --topic kafka.scaling --from-beginning</code></pre>
<ul>
<li>'배송수정' 이벤트에 이어 '배송취소' 이벤트가 순서에 맞게 퍼블리시 되었다. </li>
<li>데이터베이스를 조회해 보자.</li>
</ul>
<pre class="language-text"><code class="language-text">select * from Delivery_table;</code></pre>
<ul>
<li>최종 상태인 배송취소('DELIVERY CANCELLED') 상태가 조회된다.</li>
</ul>
<ul>
<li>주문수정과 주문취소가 (Key 설정으로) 동일한 파티션으로 퍼블리쉬 되었다. </li>
<li>해당 파티션에 매칭된 배송 서비스가 순서대로 처리해 처리순서가 보장됨을 알 수 있다.</li>
</ul>
</div><div class="mt-8 pt-8 lg:mt-12 lg:pt-12 border-t border-ui-border"><div><div class="flex flex-col sm:flex-row justify-between items-center"><!----><!----></div></div></div></div></div></div></main></div><!----><div data-v-8b0e8098><div style="width:100%; padding-bottom:30px; background-color:#1E88E5;" data-v-8b0e8098><div class="flex logo-style" data-v-8b0e8098><div data-v-8b0e8098><img src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 331 174' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-37afcb0017f229c304bfe602273e7d7c'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-37afcb0017f229c304bfe602273e7d7c)' width='331' height='174' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAiCAYAAADvVd%2bPAAAACXBIWXMAAC4jAAAuIwF4pT92AAATu0lEQVRo3sVZB3RU15lWIxhscMtunHhd8EkcJzFusb1xwMaAuoQkpFEFUWQwzXEMAQSYElFEkVCbGUmjikZdIJBAqIxmRgUJVRAqmGLABQdwTBDqZebdb/97Z0YIO1nvnrN7mHO%2b89/35pX5vvu3e8fKij69eQ4C48ffg7UZNgK5DrY9ufZ2wtJ5qwfw0cirrDSKahuCrRk0rrKuUFRb05h/Z1VhukZcP378g09vnr2VmZwtR4/Z8nNE9Ed/DAlhRfdM%2bS7X/QXkv/rWtrQ6R2cVW%2bSVNBDkoRoK9EwaCvBMGvQn60fwJcgIPnRuvkfSkBeNPWns4aEadCfrRseudN5lvmrAZU6SZJ%2bobA/Ry3XLyhXV7xPBXxGRh/%2b731PxQ3FsK%2bTi2Fojrx4TQtievP8BQSJHBJ8h%2bzrBje5ZQTaMhEulcTmN2%2bn7G925zgNS/n9K0enF3S5qwC8T8LFAfT9kZojjDMDbgkP34ENwIySnXkNraiN0CfUgAQbph39DaCQyeWT3EuHlhDk0/hXZx36MDxdovOUEnyC8SiQcyS4mbOnNtY8nW0K2lfAFobc/3wGGo05AsTNwwpXgBlbsIs4NHXZEb74zjPnvQJ2ROmKvgmF%2bUr%2bBZpQwZKDZFdaLjt0T%2bgyO8l6jo7zP6KzoNXok9hvpvJG8xUjXE8iqBgXck4alQ8ozxiq5zkAeIFUqa6BPqENNUiPqU1twOu0M6lKaUa06DRJghEhdJ9tMOMzFISwjOBB%2bTZh6T4Tq%2b1w4khU5Y6DAETjuQsRcTJbIGY%2b5YOiIM/oLnECCMAoJqTfP0XA3Z67hTsYfCTMMPbkORvpO6s51Yoa8P7JydTgcVWBeSf2MCDEiT3aI7ACzVwyyoBywtSVg60%2bCfXQcbH46mKNigK7n1wyJe4g8m0fH3nTPYUUj08n1jGafaUyQiKiRrIGsoeSgxngiUiOVx%2bpRlViPWhKHi3I6tZVEahXnuDiEvxHOE%2baYQ8DGIsBfOGma5REiQoTsDdxyknfVfzT2Z8%2bQutUzGHkI4yLczX6fjRx1ZWjczFC3FgN5c0iYuexunhNG8mayM1l/Zm4qIycCQSZpCB6JA5iXNIq4GiNi0ouxdsNWfLx2Azbt2IeUomZsLQOclIMgTwCJABIANPsIVPWgRFGLSnkVd39OBERaCFEep4dGXsM6T1xkFzRXWP2hFlYarZPoOyMXhgtEiZFbqVJRA62yFo3pbXR/tbNZAFshAM2gB3djImck8pwkiDyjmWcjDXvw93oFjLXr0Zv9Pj%2bPkWIvdGiS4ecfiDVr/oRvT8WiP3c2unMd2WDeLFzNCWZ%2bSXfZPNUwF0CQcoofRkLNABb6eYJeeR9%2bYm2FvZFyfFQEOCv76XqTAK5JI1iWeJtIVnHS4wWgcRU0cdVo03ZgzUdr4ObuhqK8YjTlnEVptNbiKXQvt0IwSdwrckjVS9/zAPtX%2b4h0r2WGcx2I0CzcOhUHV68ATHniKWzf8VdIdZvxj5RXITXtwRyne0T2hG0FqpbhH%2br30Jdnj9u57vgg%2bSu4qIxEZgDOij6sJnI790aZ77HGc88/D4c5s/DitKfFueAAH%2bypAubG9QnBvEgAZ/KYtYk3QBVAkK8wk9coq3EiogIXyj/Hnz7%2b09jvePq5X%2bBM5TlUxJgEEteaReMC8NxB9ibhSbMA1pYk%2bBTh9iDlAB7Ld7LeB8p9kZW4995M2U5GV2UyjHnv4FZNFJ5%2b/sWx75xc3IGG7ejOeAc9FAaDebOxPvUcnFQM3skDsCdSYVrAV%2bYtrqe3Iv%2b4Hse%2bBGLKbmK3IhcJFX%2bDd6oB81Q8bIaEAE4kwLaEL1Aj16LcLAAnw12/WtUA/YkqTJg4QQg6wW6CePaRjKOoS21GWaxuPHnuAcYauodE6Rgrg5ZEaK77nZYwuJNJAlQEID0uTDx00kMThd26eQNQvxJtxfsxYfLj45R/EX%2bvjUZ/9kx05zljNG8mDqSVw0FF5SypHw7yPoRSjK9eY5otG1tbTJ/%2bCjaHxyO%2b/BtENwMOCRLcE/oFeUqaYx5wIP7iPQHGzf4l3VX4%2bvmanmdjAzs7O7M3huNsQSdORlWOCVAhNwlwKrmJH580l0BrSx9gY06EpbwSmAVgqAhEauxO8VA7O1thX3jpFaArGcXJ2%2bnYZlwc/wS1R6IgFbngdraj8JJDhw5hLglApVAkQK9UBrXmMn75H0/cF///9thD%2bGjVCiTV9sFNNUKxPyBEsOQAaoJQZRaAk%2bEzW5/WguL847CyNj3DP8Afb775phgHBgbifNlllERqxvKFWQgDrwpklUIARZWtEIB3fOYwUPLSx7P/ncxZgCYIqqi/iodOmGAnwMe1ZflIVR4Q45df/h0ef/wxMY4O/xTQLsJ3mbNFL1Cq3sdLIcWzKam5xvcjOJshobgD/rL5eOZnj90nxKrlS7GbwsRe3i9yABeAyiCylS0iB5TLq8Xsl0RocKn6Khwc7cV9EydOxMWOi/Dy9BLHr73xKs5VdKIsalwIiKpRZeA9Ax1vMMe/ncUDzALYrxWl0CQAQ%2bVCKCO2i4c%2b9dTP4OnhIcZLQ5ZhY2ioGIeGbsK7774rxgEBgZQHNuN2xkyM5L%2bHlqy1cFeNjlUB14RBEgDYcwpQtALyir9jx/54/PQJUyg9%2begkJJR9SbNOiVM1IMjLVP04qjgNrVwv4v9kdCWas9qQmZo1JpyrmytGuw1YtWKVOJ7y6BToi2qgU9bR7OvHl00j7w/oOf7fL4G25hDwko5ZQoALEIy4/dtMbvrTJ3HsWLGItUcfnYpp06aJ88XHCvHh8uVi/NL036O7LhI9WTOpL5iNKzmLIEvqhQfVcj77Kw8DyowiBPnLsDu%2bENHlt1F%2b5hZeefm34v5HH54A5YmLmJfCSIB%2bCodhLErsRin1ABpz7Jce1OJCzWW88ebrYwLYUfKbNu15PPPsM2PnUpSpaFJTOYzRmgQwlUGmja/lx3%2bwlECzBzjYmEPgDXMZxJ3M9xh35%2bjwreKBDz00Cd9c6YCri5M56ViLHHCp/ggU%2b03XTJryBGs7GQdDoT3rz7dnd3Jd2AfJX1MzY2C8tMnrgHffnm66n/D8009i6iOTxn60y5wZiKk2Yq58kHknk8ckG9kq1W1mnn1WElXJ2g6fR1yU3PQMaxtMpOQ8cfLEsWfY2ppy1bpP1qG96AKoQxyrAryF1pjWEc9YSqBoh3vNy1kS4t8pHLoHqKcnASRol7DI3Z9ayOFWSzYKUvaPvWzi1J%2bhpzUJukyRKBlHbPgmSOXB0lfy6axAsYknM9ENcg9YXgCosk7gtd88B7txsT/RlsjPnQl15efwPcTYvERqiVW8ctyR1sZclKoVep4AWUVsFdprOjHtxWlj9xYVFAt3z07JwY6tOzB58mRTWXZ2wnmNSIRi5ikEJF0CD4mqL%2bj4ke/3AJZ22I7GF0YKnXFH/a4E/VIWtuUT88sm4sLJfRhqjMCiZWvw%2b7dnQBF7EJJ%2bNb6sjMD7rv7s3VmzkZGWIn2e4YfCXZ6QJXZL85JHqAz2Md4LuJAIHx6h2NcPIiK7CfsT8nFAVYD4oy2IqzVAdshIOWOAucXdwtwdTdI721vx6f561MRXSWWiqalmLaVtKMopRtS%2baCTGJ6L95GfQxp0S/f71MzcoDF8Sv3fq41PRUNLMKuNqxMxTCzzK1wZE%2bizn2nTo3L29Ab7eH/OCXIdyvrojDzCgcjGRjMKvf/caZEEhuF4bj%2bH8WaIbNDbuAXTL0JM5A/0ngjHaEoEbpaHSxewQtOz%2bzTerFU2pjqnU28cbpbnxYPbxIHIGeCTcxaK0r7D%2byDdYkAsEZQGeKcCcGAluSgN5DHWCu65Is7e04q3QlvbMyLq6hsRGEBGpMo5qeUw1TiU3oyW7HWfyO6gk6kWio4UQTqkboSmqRPS%2bGGzaFMpOVzSxshgdjkeVGYoiS8V1ZHdxnof3FtmMXwqLRsg8TuCVQCyG8p1Yb00Yhhv2AY3bMXDMB3ezqd9Xz8DdjD9wkajrcyQRZqEn/Q%2bs/q/TUfHpa7i2Y/J7ATmG5esKv8POww2G5JJjrESbgDP12/F162o20uWDr5rWMO%2b0a8yn8DjzP6JBwJEa5lvQAN%2b8s8w9vgLOUSfhrM5aWnjo%2bMky9SkUJdJqL0HLSuN1KJPrGFUDgXEZHnwlSJ0ea8lpZ53FF3E0%2bgSTr08YTd2WAcWGxMHotfLFltnftTL8BxsetuY8sMHSC4hFURatANXvsDu8xc2ZLdYJRJrgxFeGUm%2bBg9RX7MJ6S93ZdfKcm1r324aLvvqecwu6Bzr8YOhwZaxjDkPnbOAzdxjPe8Jw3oN1t4Vg5dFTWFC9E0uqd7HF1buwuHo3FmjD2ELdHgTrw43Bur1scdVBLNVFsg%2b0B7FCE81Wl8fiz6UKdlRVYdDKawyU3fmqT7q3OtQxnvmPR5Qb4zcmSenbMxEfmtSYuDnlRc6vOaPdOnz1/vs3Q3pMe34WD5hvpFJI5EfFyjDPicPA1/9mUfi6H/0FDhjimyM6dwx/JmPD52Ug4ky67A9c8QEuuAGfyxi%2bDgFuUvt8YyOGaeYHO2VsiOxohz/bUZrd76eNYot1kQjWRrIg3QGsaVVhdUsiW96oQMjpWCyoiWB%2bleEkyAG2UH8AgVX72BJ9JDTqOjSmnEVtciP0CfWoVIryxpOdQRd/auRY5EmoNqciYVNypGWSlRtVdiSGZXzfbpDYD7SUwkGqAhyjtC7grTHfFLFskBiPibUCx0BPtv3XfSddLnHyQ50%2bBBkG2z0Zu7bG2H01RTpTk4Dighi2J2wD2xW2DX1XDmCkcx4b6PQDzntJmQ1/OS/TRklLiViQbj%2bLbi6APCuZRWUmQHE4nSmLM5i6rpjtbctDYCV5gz6SPCUSIdqDdwuTyg9o42oyyANqiTjP7AN8rc/zQ2P6WaRtU9%2bKWadws5An4rYW4hYRvh8C1mb7C8JNwrdUEtvJaqk6ZJDdTZ7C9wE9qGN8m1z/%2bW8/fMVu6Jz3NCI/NEoiDLR7M1wJRIM%2bFT9/5mXKxrb3St0jv8D1LjWkC57o7/BlJADyGz8xkAAsuHIvVjQpWUZR3n2t8aQJEzHJegKiE%2bVY15aKQE24tLQumnvD1fv29xRVD5EAz9KMzqCMv6AkWrOZZv9Z/l3iphRbImxtFsGKPOKfbxJaNkaJHN8ZfpaOn6Txj253D1/yfWi4S3YFl/3Q1%2bYp4cYKpCbsFgR%2b%2b9uXUHQkFV2tJzB6tw34ZiMGzrmxwS7hAexQw3r4aKNAHsACdfsQ1VoAZX4aEnLTsHLlyjEhFNkpWNOSiCDNXuPS%2bhgs0kV05aaW2DUcbLQ5mJfzL3%2bjZdZ/lPz4rfF/5hm8U%2bTrBfresl1u03vUyXqg1kOEDQmgwxcB3AOMuBbIasqU4oe//tprqNEeQUzEpwhe4IfTmjjgajDr455yfj7i60MZCUAxfQCL9BHMXxOO1W0q6L48g7feMK3swnaGIfryccjKKUnqI408LwTrIk7z966siLVWqQutzP8BUFdXZVOpqLE9GVNpm/xpuhAmb0/hjxO/rxka/ydI7g//IOkR5%2bytyO05caEwxb4KXwVisENmYBe92NWzKkx%2b5Kc/2PZKT9oPXF%2bBvnNeYF3z2cG6LYxCAEIASoABur3Iv6DHrHdmiuuXLQlB2tVK%2bFRw8hFE/IAxpCGOi1XO30vWms5ZBBC/nxKgFVUBq5xdBeK4cP/x/59/ZYY7ZWMCkP2ECzDU6WsY6XRF3zUFXvilqedXxh3A9YslGL7TAgwVstHz89kgJUzpMx8WXreN%2bVJ5W0qzL9PshvqaDouCFor7fLy8UXyjCX41%2b3gCFB5CZA0fNMZxIXL5e8nacAEeyIdI3xOgU%2baKq/4Y6vI1Dp5zZrh5EHPmmhZN0ZF7kK%2bOwIchPliyZAn7x6VYIj%2bP3WnxxpbqHQjURzH/it3Y1ZWHzVu3iHsmP/wwktNSkFqej3R9Idvdms0CtXt5CIwua1ZwMUQaX1QVaUtjqwf2IQFEDhjqkv2OavzoyHlf9J11ZfhuB1auWvP9EGDP/fItfNGexq5o5qC2wElaVblrMLg6iuJ7J1NeKkGgt98PwoZewLLKjmBZo1xaoNk3%2bkGTHEFl4aH8vUGle2wftAdYm8Y%2bU2l8Q7roR3nARyJLeSCJ7dgWyhTR21FRFMsutaaykb%2blse5ziw1njs6G9qjHroCq6Mshp6K4S0tLa6JYWlsJk%2belsMg0BYtMjGWb92xnO8J3Ql5fYHTP3Ajv7C20tF471ti4xn/8QGd/DObjRlzxp25PZhzsmM%2bki74Svv2LETc/MuDLhQZc8jZKn7kZBju80JA3J/vnl5unUOLrXVwVyV3asFC73xig32dY3qQwfNSqMmxoPzS6uTPTsPVCzohfcRhcEv4Mt8RPVo%2bRV5rIU1l8sCJQNbAxVwI1rvnzjnB4hJoi4wVfsAteprb4C2qPPydcDcTNBq/O9t9Y/URWp3xhMWX/pXUx4M1NSEMsd3MsJcux%2bDQ1PHVRWNQQDc%2bM0H4X5ccu/D00tvVI3yA8z0sdahV4YveDE2BIVAIfO7MYu3B3MXhDRCIY6PjWcJdvM9kcQhghkM7/J7uyYAq/fr12%2b%2bRgfcTvyQveJw9wpzAIIruKsJGwkxBD3pG2sGJfjkfahtf5PfPS1tvNS1on3u2mWmvlmbLe6oF/7uUB2duErQR3wnTCo//qnqpyX5v/7Xvck9eNdXWc/P/l578AjufF27Pdj9IAAAAASUVORK5CYII=' /%3e%3c/svg%3e" width="331" data-src="/assets/static/logo.34ff00f.bd727e13501e82a0ba322b4ad29fd33a.png" data-srcset="/assets/static/logo.34ff00f.bd727e13501e82a0ba322b4ad29fd33a.png 331w" data-sizes="(max-width: 331px) 100vw, 331px" class="g-image g-image--lazy g-image--loading" data-v-8b0e8098 data-v-8b0e8098><noscript data-v-8b0e8098 data-v-8b0e8098><img src="/assets/static/logo.34ff00f.bd727e13501e82a0ba322b4ad29fd33a.png" class="g-image g-image--loaded" width="331"></noscript></div></div><div style="width:100%; text-align:center; font-size:14px; color:white; font-weight:300; line-height:1.5; padding-top:20px;" data-v-8b0e8098><div data-v-8b0e8098><div data-v-8b0e8098><div class="footer-top-div" data-v-8b0e8098>© MSA-Ez Authors 2023.  </div><div class="footer-top-div" data-v-8b0e8098>© 2023 uEngine All rights reserved.</div></div><div data-v-8b0e8098>
                    uEngine has registered trademarks and uses trademarks. and MSA-Ez is licensed under the GNU General Public License version 3.0.
                </div></div><div class="footer-bot" data-v-8b0e8098><div data-v-8b0e8098><a href="https://www.gnu.org/licenses/gpl-3.0.en.html#license-text" target="_blank" style="color:#fff;" data-v-8b0e8098>
                        See LICENSE
                    </a>
                      |   
                </div><div data-v-8b0e8098><a href="https://github.com/msa-ez/platform" target="_blank" style="color:#fff;" data-v-8b0e8098>
                        Github Site
                    </a>
                      |   
                </div><div data-v-8b0e8098>E-Mail: help@uengine.org</div></div></div></div></div></div>
    <script>window.__INITIAL_STATE__={"data":{"markdownPage":{"id":"24b5631c36cc1b2b9a6a67ff6070dd1e","title":"Kafka scaling & Concurrenty handling","description":"","path":"\u002Fdevelopment\u002Fkafka-scaling-concurrenty-handling\u002F","timeToRead":6,"content":"\u003Ch1 id=\"kafka-scaling--concurrenty-handling\"\u003E\u003Ca href=\"#kafka-scaling--concurrenty-handling\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EKafka scaling &#x26; Concurrenty handling\u003C\u002Fh1\u003E\n\u003Ch2 id=\"kafka-메시지-동시성-처리\"\u003E\u003Ca href=\"#kafka-%EB%A9%94%EC%8B%9C%EC%A7%80-%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%B2%98%EB%A6%AC\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EKafka 메시지 동시성 처리\u003C\u002Fh2\u003E\n\u003Cul\u003E\n\u003Cli\u003EKafka 파티션 스케일아웃에 따른 동시성 이슈를 확인한다.\u003C\u002Fli\u003E\n\u003Cli\u003E컨슈머 측에서 순서가 보장되기 위한 설정을 이해하고 실습한다.\u003C\u002Fli\u003E\n\u003Cli\u003ECODE \u003E ProjectIDE로 GitPod 실습환경을 실행한다.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch3 id=\"주문-배송서비스-실행\"\u003E\u003Ca href=\"#%EC%A3%BC%EB%AC%B8-%EB%B0%B0%EC%86%A1%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%8B%A4%ED%96%89\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E주문, 배송서비스 실행\u003C\u002Fh3\u003E\n\u003Cul\u003E\n\u003Cli\u003E카프카 실행상태를 확인하고, 사용할 MySQL DB를 시작한다.\u003C\u002Fli\u003E\n\u003Cli\u003E주문, 배송 마이크로서비스를 실행하고, 주문에 따른 배송 프로세스를 확인한다.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003Ecd mysql\ndocker-compose up -d\n\ncd order\nmvn clean spring-boot:run\n\ncd delivery\nmvn clean spring-boot:run\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 id=\"test---싱글-파티션-싱글-컨슈머-환경\"\u003E\u003Ca href=\"#test---%EC%8B%B1%EA%B8%80-%ED%8C%8C%ED%8B%B0%EC%85%98-%EC%8B%B1%EA%B8%80-%EC%BB%A8%EC%8A%88%EB%A8%B8-%ED%99%98%EA%B2%BD\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003ETest - 싱글 파티션, 싱글 컨슈머 환경\u003C\u002Fh2\u003E\n\u003Cul\u003E\n\u003Cli\u003E새로운 터미널에서 카프카 토픽을 실시간 모니터링한다.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003Ecd kafka\ndocker-compose exec kafka \u002Fbin\u002Fbash\ncd \u002Fbin\n.\u002Fkafka-console-consumer --bootstrap-server localhost:9092 --topic kafka.scaling --from-beginning\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003E새로운 터미널을 오픈해 주문을 실행한다.\u003C\u002Fli\u003E\n\u003Cli\u003EPARK(id: 1000) 주문에 이어, KIM(id: 2000) 주문도 생성한다.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003Ehttp :8081\u002Forders customerId=1000 productId=100 productName=TV qty=3 address=SEOUL\nhttp :8081\u002Forders customerId=2000 productId=100 productName=RADIO qty=3 address=PUSAN\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003EKIM이 배송지 정보를 수정(PUSAN \u003E SEOUL)한다.\u003C\u002Fli\u003E\n\u003Cli\u003E주문수정이 일어나면 배송서비스에서는 10초의 딜레이가 발생하도록 설정되어 있다.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003Ehttp PATCH :8081\u002Forders\u002F2 address=SEOUL\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003EKIM이 주문을 삭제한다.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003Ehttp DELETE :8081\u002Forders\u002F2\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003E컨슈머가 하나일 때는 싱글 스레드로 동작해 설정된 딜레이 시간이 경과된 후 수정,삭제가 일어난다. \u003C\u002Fli\u003E\n\u003Cli\u003E'배송수정(DELIVERY MODIFIED)'에 이어 '배송취소(DELIVERY CANCELLED)' 이벤트가 카프카에 수신되었다. \u003C\u002Fli\u003E\n\u003Cli\u003E새로운 터미널에서 데이터베이스를 조회해 보자.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003Ecd mysql\ndocker-compose exec -it master-server bash\nmysql --user=root --password=1234\nuse my-database;\nselect * from Delivery_table;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003E배송서비스 테이블에 최종 배송취소 상태값(DELIVERY CANCELLED)이 정상적으로 조회된다.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch2 id=\"test---멀티-파티션-멀티-컨슈머-환경\"\u003E\u003Ca href=\"#test---%EB%A9%80%ED%8B%B0-%ED%8C%8C%ED%8B%B0%EC%85%98-%EB%A9%80%ED%8B%B0-%EC%BB%A8%EC%8A%88%EB%A8%B8-%ED%99%98%EA%B2%BD\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003ETest - 멀티 파티션, 멀티 컨슈머 환경\u003C\u002Fh2\u003E\n\u003Cp\u003E\u003Cu\u003E12st Mall 사용량이 증가해 카프카와 배송서비스를 증설(스케일 아웃)할 필요가 생겼다고 가정해 보자. \u003C\u002Fu\u003E\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E열린 카프카 터미널에서 파티션을 2개(default 1)로 Scale Out 한다.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003E.\u002Fkafka-topics --bootstrap-server 127.0.0.1:9092 --alter --topic kafka.scaling -partitions 2\n.\u002Fkafka-topics --bootstrap-server 127.0.0.1:9092 --topic kafka.scaling --describe\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003E새로운 터미널에서 두번째 배송 서비스를 실행(Scale Out) 한다.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003Ecd delivery-2nd\nmvn clean spring-boot:run\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 id=\"1-처리순서가-지켜지지-않는-메시징\"\u003E\u003Ca href=\"#1-%EC%B2%98%EB%A6%AC%EC%88%9C%EC%84%9C%EA%B0%80-%EC%A7%80%EC%BC%9C%EC%A7%80%EC%A7%80-%EC%95%8A%EB%8A%94-%EB%A9%94%EC%8B%9C%EC%A7%95\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E1. 처리순서가 지켜지지 않는 메시징\u003C\u002Fh2\u003E\n\u003Ch3 id=\"동일한-주문이-여러-파티션에-랜덤하게-적재되는-경우\"\u003E\u003Ca href=\"#%EB%8F%99%EC%9D%BC%ED%95%9C-%EC%A3%BC%EB%AC%B8%EC%9D%B4-%EC%97%AC%EB%9F%AC-%ED%8C%8C%ED%8B%B0%EC%85%98%EC%97%90-%EB%9E%9C%EB%8D%A4%ED%95%98%EA%B2%8C-%EC%A0%81%EC%9E%AC%EB%90%98%EB%8A%94-%EA%B2%BD%EC%9A%B0\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E동일한 주문이 여러 파티션에 랜덤하게 적재되는 경우,\u003C\u002Fh3\u003E\n\u003Cul\u003E\n\u003Cli\u003EKIM(id: 2000)이 주문을 생성한다.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003Ehttp :8081\u002Forders customerId=2000 productId=100 productName=RADIO qty=3 address=PUSAN\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003EKIM이 배송지 정보를 수정(PUSAN \u003E SEOUL)한다.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003Ehttp PATCH :8081\u002Forders\u002F{order-id} address=SEOUL\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003EKIM이 주문을 삭제한다.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003Ehttp DELETE :8081\u002Forders\u002F{order-id}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003E'주문수정'과 '주문취소' 메시지는 라운드로빈으로 각각 다른 파티션에 저장된다. \u003C\u002Fli\u003E\n\u003Cli\u003E배송 서비스는 각 매칭된 파티션으로부터 이벤트를 수신하여 동시성 처리가 일어난다.\u003C\u002Fli\u003E\n\u003Cli\u003E이때, 한 배송 서비스가 '주문수정' 이벤트를 수신하여 딜레이(10초)만큼 대기하는 동안에,\u003C\u002Fli\u003E\n\u003Cli\u003E다른 배송 서비스가 '주문취소' 이벤트를 수신하여 해당 배송정보를 먼저 삭제 처리해 버린다.\u003C\u002Fli\u003E\n\u003Cli\u003E이는 곧, 고객에 의해 삭제 처리된 배송정보에 대해 배송수정 로직을 적용하는 모순이 벌어지게 된다. \u003C\u002Fli\u003E\n\u003Cli\u003E카프카 컨슈머로 토픽을 조회해 보자.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003E.\u002Fkafka-console-consumer --bootstrap-server localhost:9092 --topic kafka.scaling --from-beginning\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003E'DeliveryCancelled' 이벤트가 'DeliveryModified' 이벤트보다 먼저 카프카에 퍼블리시 되었다. \u003C\u002Fli\u003E\n\u003Cli\u003E데이터베이스를 조회해 보자.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003Eselect * from Delivery_table;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003E삭제되어야 할 배송정보가 수정된 채로 조회되고 있으며, 이는 메시지 처리 순서상 문제가 발생했음을 알 수 있다. \u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch2 id=\"2-처리순서가-보장되는-메시징\"\u003E\u003Ca href=\"#2-%EC%B2%98%EB%A6%AC%EC%88%9C%EC%84%9C%EA%B0%80-%EB%B3%B4%EC%9E%A5%EB%90%98%EB%8A%94-%EB%A9%94%EC%8B%9C%EC%A7%95\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E2. 처리순서가 보장되는 메시징\u003C\u002Fh2\u003E\n\u003Ch3 id=\"동일한-주문이-동일-파티션에-적재되는-경우\"\u003E\u003Ca href=\"#%EB%8F%99%EC%9D%BC%ED%95%9C-%EC%A3%BC%EB%AC%B8%EC%9D%B4-%EB%8F%99%EC%9D%BC-%ED%8C%8C%ED%8B%B0%EC%85%98%EC%97%90-%EC%A0%81%EC%9E%AC%EB%90%98%EB%8A%94-%EA%B2%BD%EC%9A%B0\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E동일한 주문이 동일 파티션에 적재되는 경우,\u003C\u002Fh3\u003E\n\u003Cul\u003E\n\u003Cli\u003E멀티 파티션, 멀티 컨슈머 환경에서 처리순서가 보장되려면, 키(Key)와 함께 이벤트를 퍼블리시 한다.\u003C\u002Fli\u003E\n\u003Cli\u003E카프카 파티셔너는 동일한 키에 대해 동일 파티션에 이벤트를 적재해 준다.\u003C\u002Fli\u003E\n\u003Cli\u003E이를 적용해 보자.\u003C\u002Fli\u003E\n\u003Cli\u003E주문 서비스에서 Order id를 메시지 키로 하여 퍼블리시 되도록 Key를 추가한다.\u003C\u002Fli\u003E\n\u003Cli\u003EOrder \u003E Order.java 포트 메소드에서 아래대로 수정한다.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003E# 34,40,49 line modify\norderPlaced.publishAfterCommit(getId());\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003E아래 코드를 복사하여 Order \u003E AbstractEvent.java 62라인에 추가한다.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003E    public void publish(String messageKey) {\n        \u002F**\n         * spring streams 방식\n         *\u002F\n        KafkaProcessor processor = OrderApplication.applicationContext.getBean(\n            KafkaProcessor.class\n        );\n        MessageChannel outputChannel = processor.outboundTopic();\n \n        outputChannel.send(\n            MessageBuilder\n                .withPayload(this)\n                .setHeader(\n                    MessageHeaders.CONTENT_TYPE,\n                    MimeTypeUtils.APPLICATION_JSON\n                )\n                .setHeader(&quot;type&quot;, getEventType())\n                .setHeader(KafkaHeaders.MESSAGE_KEY, messageKey.getBytes())\n                .build()\n        );\n    }\n\n    public void publishAfterCommit(Long messageKey) {\n        TransactionSynchronizationManager.registerSynchronization(\n            new TransactionSynchronizationAdapter() {\n                @Override\n                public void afterCompletion(int status) {\n                    AbstractEvent.this.publish(String.valueOf(messageKey));\n                }\n            }\n        );\n    }\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003E주문서비스를 재시작한다. \u003C\u002Fli\u003E\n\u003Cli\u003EKIM(id: 2000)이 주문을 생성한다.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003Ehttp :8081\u002Forders customerId=2000 productId=100 productName=RADIO qty=3 address=PUSAN\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003EKIM이 배송지 정보를 수정(PUSAN \u003E SEOUL)한다.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003Ehttp PATCH :8081\u002Forders\u002F{order-id} address=SEOUL\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003EKIM이 주문을 삭제한다.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003Ehttp DELETE :8081\u002Forders\u002F{order-id}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003E카프카 컨슈머로 토픽을 조회해 보자.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003E.\u002Fkafka-console-consumer --bootstrap-server localhost:9092 --topic kafka.scaling --from-beginning\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003E'배송수정' 이벤트에 이어 '배송취소' 이벤트가 순서에 맞게 퍼블리시 되었다. \u003C\u002Fli\u003E\n\u003Cli\u003E데이터베이스를 조회해 보자.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003Eselect * from Delivery_table;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003E최종 상태인 배송취소('DELIVERY CANCELLED') 상태가 조회된다.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cul\u003E\n\u003Cli\u003E주문수정과 주문취소가 (Key 설정으로) 동일한 파티션으로 퍼블리쉬 되었다. \u003C\u002Fli\u003E\n\u003Cli\u003E해당 파티션에 매칭된 배송 서비스가 순서대로 처리해 처리순서가 보장됨을 알 수 있다.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n","sidebar":"started","next":"","prev":"","headings":[{"depth":1,"value":"Kafka scaling & Concurrenty handling","anchor":"#kafka-scaling--concurrenty-handling"},{"depth":2,"value":"Kafka 메시지 동시성 처리","anchor":"#kafka-메시지-동시성-처리"},{"depth":3,"value":"주문, 배송서비스 실행","anchor":"#주문-배송서비스-실행"},{"depth":2,"value":"Test - 싱글 파티션, 싱글 컨슈머 환경","anchor":"#test---싱글-파티션-싱글-컨슈머-환경"},{"depth":2,"value":"Test - 멀티 파티션, 멀티 컨슈머 환경","anchor":"#test---멀티-파티션-멀티-컨슈머-환경"},{"depth":2,"value":"1. 처리순서가 지켜지지 않는 메시징","anchor":"#1-처리순서가-지켜지지-않는-메시징"},{"depth":3,"value":"동일한 주문이 여러 파티션에 랜덤하게 적재되는 경우,","anchor":"#동일한-주문이-여러-파티션에-랜덤하게-적재되는-경우"},{"depth":2,"value":"2. 처리순서가 보장되는 메시징","anchor":"#2-처리순서가-보장되는-메시징"},{"depth":3,"value":"동일한 주문이 동일 파티션에 적재되는 경우,","anchor":"#동일한-주문이-동일-파티션에-적재되는-경우"}]},"allMarkdownPage":{"edges":[{"node":{"path":"\u002Ftool\u002Fmarketplace\u002F","title":"Template\u002FTopping Marketplace"}},{"node":{"path":"\u002Ftool\u002Finfrastructure-modeling\u002F","title":"Infrastructure Modeling (Kubernetes)"}},{"node":{"path":"\u002Foperations\u002Fistio-metric-based-hpa\u002F","title":"[Service Mesh] Istio Metrics based HPA"}},{"node":{"path":"\u002Fdevelopment\u002Fops-docker\u002F","title":"Application Packaging with Container (Docker)"}},{"node":{"path":"\u002Ftool\u002Fgoogle-drive-examples\u002F","title":"Google Drive Examples"}},{"node":{"path":"\u002Ftool\u002Fon-prem-inst\u002F","title":"Installing on-premise MSA-Easy"}},{"node":{"path":"\u002Ftool\u002Fevent-storming-tool\u002F","title":"EventStorming"}},{"node":{"path":"\u002Ftool\u002Fcloud-ide-tool\u002F","title":"Cloud IDE"}},{"node":{"path":"\u002Ftool\u002Fdevelopment-practice\u002F","title":"Registration Course"}},{"node":{"path":"\u002Ftool\u002Fattending-lectures\u002F","title":"Attending lectures"}},{"node":{"path":"\u002Foperations\u002Fops-persistence-volume-azure\u002F","title":"파일공유를 위한 클라우드 스토리지 활용(Azure)"}},{"node":{"path":"\u002Ftemplates-language\u002Fpython-template\u002F","title":"Python template "}},{"node":{"path":"\u002Ftemplates-language\u002Fspringboot-java-template\u002F","title":"Spring Boot\u002FJava Template"}},{"node":{"path":"\u002Ftool\u002Fchat-gpt\u002F","title":"Chat GPT-based Model Generation"}},{"node":{"path":"\u002Ftemplates-language\u002Fgo-template\u002F","title":"Go Template "}},{"node":{"path":"\u002Foperations\u002Fservice\u002F","title":"12번가 마이크로서비스 라우터(Service) 생성"}},{"node":{"path":"\u002Foperations\u002Fops-utility\u002F","title":"쿠버네티스 유틸리티"}},{"node":{"path":"\u002Foperations\u002Fservice-mesh-ab-testing\u002F","title":"Istio based A\u002FB testing 배포"}},{"node":{"path":"\u002Foperations\u002Fops-service-mesh-istio-2\u002F","title":"[Service Mesh] Istio-2"}},{"node":{"path":"\u002Foperations\u002Fops-persistence-volume\u002F","title":"파일시스템 (볼륨) 연결과 데이터베이스 설정"}},{"node":{"path":"\u002Foperations\u002Fops-service-mesh-istio\u002F","title":"[Service Mesh] Istio"}},{"node":{"path":"\u002Foperations\u002Fops-readiness\u002F","title":"셀프힐링 & 무정지 배포 실습"}},{"node":{"path":"\u002Foperations\u002Fops-pod-status\u002F","title":"Pod 상태값에 따른 마이크로서비스 트러블 슈팅"}},{"node":{"path":"\u002Foperations\u002Fops-persistence-volume-efs\u002F","title":"파일공유를 위한 NAS 스토리지 생성과 설정"}},{"node":{"path":"\u002Foperations\u002Fops-persistence-volume-gcp\u002F","title":"파일공유를 위한 클라우드 스토리지 활용(GCP)"}},{"node":{"path":"\u002Foperations\u002Fops-liveness\u002F","title":"셀프힐링 실습"}},{"node":{"path":"\u002Foperations\u002Fops-ingress-virtualhost\u002F","title":"Ingress - Virtual Host based"}},{"node":{"path":"\u002Foperations\u002Fops-label-annotation\u002F","title":"Labels and Annotations"}},{"node":{"path":"\u002Foperations\u002Fops-kubernetes\u002F","title":"Kubernetes Basic Command"}},{"node":{"path":"\u002Foperations\u002Fops-ingress\u002F","title":"Ingress 를 통한 진입점 통일 - Path-based routing"}},{"node":{"path":"\u002Foperations\u002Fops-aws-setting\u002F","title":"AWS Cloud Setup(EKS, ECR 설정)"}},{"node":{"path":"\u002Foperations\u002Fops-configmap\u002F","title":"Kubernetes에 환경변수 구성하기"}},{"node":{"path":"\u002Foperations\u002Fops-deploy-my-app\u002F","title":"애플리케이션 패키징,도커라이징,클러스터 배포"}},{"node":{"path":"\u002Foperations\u002Fops-aws-csi-setting\u002F","title":"AWS Cloud Setup(Container Storage Interface)"}},{"node":{"path":"\u002Foperations\u002Fops-autoscale\u002F","title":"Pod Auto Scaling"}},{"node":{"path":"\u002Foperations\u002Fops-argo-rollout-canary-istio\u002F","title":"[GitOps] Argo Rollout 와 Istio 를 통한 카나리 배포"}},{"node":{"path":"\u002Foperations\u002Fops-anatomy-kubernetes\u002F","title":"쿠버네티스 내부구조 분석"}},{"node":{"path":"\u002Foperations\u002Fmicroservice-logging2\u002F","title":"마이크로서비스 통합 로깅 with Loki stack"}},{"node":{"path":"\u002Foperations\u002Fistio-sre-monitoring\u002F","title":"Service Reliability Engineering"}},{"node":{"path":"\u002Foperations\u002Fmicroservice-logging\u002F","title":"마이크로서비스 통합 로깅 with EFK stack"}},{"node":{"path":"\u002Foperations\u002Fistio-traffic\u002F","title":"[Service Mesh] Istio 를 통한 동적 트래픽 라우팅"}},{"node":{"path":"\u002Foperations\u002Fk8s-monitoring\u002F","title":"MSA 모니터링 with installing Grafana"}},{"node":{"path":"\u002Foperations\u002Fistio-resiliency-part2\u002F","title":"[Service Mesh] Istio 를 통한 서비스 회복성 Part2 - 서킷브레이커"}},{"node":{"path":"\u002Foperations\u002Fistio-msa-telemetry\u002F","title":"[Service Mesh] MSA 모니터링 w\u002F Istio addon Grafana"}},{"node":{"path":"\u002Foperations\u002Fistio-resiliency-part1\u002F","title":"[Service Mesh] Istio 를 통한 서비스 회복성 Part1 - 타임아웃\u002F재시도"}},{"node":{"path":"\u002Fstarted\u002Fdomain-driven\u002F","title":"Domain-Driven Design Learning"}},{"node":{"path":"\u002Foperations\u002Fend-to-end\u002F","title":"12번가 전체 마이크로서비스의 배포"}},{"node":{"path":"\u002Foperations\u002Fapply-security-to-12st-mall\u002F","title":"12번가 Mall에 토큰인증 적용하기"}},{"node":{"path":"\u002Fstarted\u002Fevent-storming-learning\u002F","title":"Event Storming Learning"}},{"node":{"path":"\u002Foperations\u002Fgitops-argo-cd\u002F","title":"[GitOps] Argo CD 를 통한 카나리 배포"}},{"node":{"path":"\u002Foperations\u002Fazure\u002F","title":"Azure Cloud Setup (AKS, ACR 설정)"}},{"node":{"path":"\u002Fstarted\u002F","title":"Introduction"}},{"node":{"path":"\u002Fdevelopment\u002Fkafka-connect\u002F","title":"CDC(Change Data Capture) with Kafka"}},{"node":{"path":"\u002Fcustom-template\u002Funit-test\u002F","title":"Unit Test Creation Topping(New)"}},{"node":{"path":"\u002Fcustom-template\u002Fmock-server\u002F","title":"Open API 3.0-based Mock Server Generation Topping(New)"}},{"node":{"path":"\u002Fcustom-template\u002Ftutorial\u002F","title":"Concept of Custom Template"}},{"node":{"path":"\u002Fexample-scenario\u002Fanimal-hospital\u002F","title":"Veterinary Practice Management System"}},{"node":{"path":"\u002Fexample-scenario\u002Ffood-delivery\u002F","title":"food delivery"}},{"node":{"path":"\u002Fcustom-template\u002Fdesigning-template\u002F","title":"Developing Custom Template"}},{"node":{"path":"\u002Fexample-scenario\u002Faccommodation-reservation\u002F","title":"AirBnB"}},{"node":{"path":"\u002Fexample-scenario\u002Fonline-lecture\u002F","title":"Internet lecture system"}},{"node":{"path":"\u002Fcustom-template\u002Fcustom-template\u002F","title":"Custom Template Objects"}},{"node":{"path":"\u002Fexample-scenario\u002Flibrary-system\u002F","title":"library system"}},{"node":{"path":"\u002Fdevelopment\u002Fpubsub-idempotency\u002F","title":"Pub\u002FSub Communication - Choreography with Idempotency"}},{"node":{"path":"\u002Fdevelopment\u002Funderstanding-jpa-based-single-microservice\u002F","title":"Understanding JPA Based Single Microservice"}},{"node":{"path":"\u002Fdevelopment\u002Ftoken-based-auth\u002F","title":"JWT Token-based Authorization"}},{"node":{"path":"\u002Fdevelopment\u002Fpub-sub\u002F","title":"Pub\u002FSub Communication"}},{"node":{"path":"\u002Fdevelopment\u002Forchestration-saga\u002F","title":"Orchestration Saga with Axon Framework"}},{"node":{"path":"\u002Fdevelopment\u002Fpubsub-deadline\u002F","title":"Pub\u002FSub Communication - Choreography with Deadline added"}},{"node":{"path":"\u002Fdevelopment\u002Foauth2with-keycloak\u002F","title":"JWT Token-based Authorization - Advanced"}},{"node":{"path":"\u002Fdevelopment\u002Fmonolith-2-misvc\u002F","title":"MSA Communication by Req\u002FRes"}},{"node":{"path":"\u002Fdevelopment\u002Fkafka-scaling\u002F","title":"Kafka Scaling "}},{"node":{"path":"\u002Fdevelopment\u002Fkafka-scaling-concurrenty-handling\u002F","title":"Kafka scaling & Concurrenty handling"}},{"node":{"path":"\u002Fdevelopment\u002Fkafka-retry-dlq\u002F","title":"Kafka Retry & Dead Letter Queue "}},{"node":{"path":"\u002Fdevelopment\u002Fdp-frontend\u002F","title":"Data Projection with Frontend and HATEOAS"}},{"node":{"path":"\u002Fdevelopment\u002Fkafka-basic\u002F","title":"Kafka Basic Commands"}},{"node":{"path":"\u002Fdevelopment\u002Fgateway\u002F","title":"API Gateway"}},{"node":{"path":"\u002Fdevelopment\u002Fconteact-messaging\u002F","title":"Conteact Test by Message-based CDC"}},{"node":{"path":"\u002Fbusiness\u002Feventstorming-fooddelivery\u002F","title":"Food Delivery Example"}},{"node":{"path":"\u002Fdevelopment\u002Fdp-graphql\u002F","title":"Data Projection with GraphQL"}},{"node":{"path":"\u002Fdevelopment\u002Fcontract-test\u002F","title":"Contract Test (Consumer Driven Test)"}},{"node":{"path":"\u002Fdevelopment\u002Fdp-cqrs\u002F","title":"Data Projection with CQRS"}},{"node":{"path":"\u002Fdevelopment\u002Fcompensation-correlation\u002F","title":"Pub\u002FSub Communication - Compensation & Correlation"}},{"node":{"path":"\u002Fdevelopment\u002Fchoreography-saga\u002F","title":"Choreography Saga with Axon Framework"}},{"node":{"path":"\u002Fdevelopment\u002Fcna-start\u002F","title":"Running Microservice Units"}},{"node":{"path":"\u002Fdevelopment\u002Fcircuit-breaker\u002F","title":"Circuit Breaker for Req\u002FRes"}},{"node":{"path":"\u002Fcontact\u002Fquestion\u002F","title":"CONTACT"}},{"node":{"path":"\u002Fbusiness\u002Fddd-google-drive\u002F","title":"Google Drive Example"}},{"node":{"path":"\u002Fbusiness\u002F","title":"Shopping Mall Example"}}]}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.1663a9ab.js" defer></script><script src="/assets/js/page--src--templates--markdown-page-vue.eef38ce3.js" defer></script>
  </body>
</html>
